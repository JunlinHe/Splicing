function SkyApp(){var a=this;$.cookie.json=true;a.version="1.0";a.offline=false;if(!sessionStorage.authority&&!$.cookie("authority")){location.href="login.html";return}a.serverUrl="p";a.evClick="click";a.evTap="tap";a.evDbClick="dblclick";a.evDbTap="doubletap";a.evPress="press";a.evRightClick="contextmenu";a.evStar="MSPointerStart pointerstart touchstart mousedown";a.evMove="MSPointerMove pointermove touchmove mousemove";a.evEnd="MSPointerUp pointerup touchend mouseup";a.evOut="MSPointerOut pointerout touchcancel mouseout";a.attrGrid="data-cvs-grid";a.attrGridStep="data-cvs-grid-step";a.attrWinId="data-win-id";a.attrWinSId="data-win-sid";a.attrWinLevel="data-win-level";a.attrWinInfo="data-win-info";a.attrSignalId="data-signal-id";a.attrSignalValid="data-signal-valid";a.attrSignalColor="data-signal-color";a.attrSceneId="data-scene-id";a.attrCommType="data-comm-type";a.selWall="#sky-wrapper > .tab-content > .tab-pane";a.selActiveWall="#sky-wrapper > .tab-content > .tab-pane.active";a.selInputList="#sky-wrapper .input ul";a.selActiveInputList="#sky-wrapper > .tab-content > .tab-pane.active .input ul";a.selSceneList="#sky-wrapper .scene ul";a.selActiveSceneList="#sky-wrapper > .tab-content > .tab-pane.active .scene ul";a.selPlaceholder="#sky-wrapper > .tab-content > .tab-pane .placeholder";a.selActivePlaceholder="#sky-wrapper > .tab-content > .tab-pane.active .placeholder";a.selDroppable="#sky-wrapper > .tab-content > .tab-pane .placeholder>.droppable";a.selActiveDroppable="#sky-wrapper > .tab-content > .tab-pane.active .placeholder>.droppable";a.dbName="skyDB";a.tblWinInfo="tbl_win_wall";a.tblSceneInfo="tbl_scene_wall";a.tblSetting="tbl_setting";a.editPanelSize={w:false,h:false};a.scale=[];a.scaleX=[];a.scaleY=[];a.enableGesture=true;a.settings={commType:"0",commInfo:[{com_port:3,com_baud_rate:115200},{ip:"192.168.1.128",mac:"0,8,220,1,2,3",mask:"255,255,255,0",gate:"192,168,1,1",port:"5100"}],splice:[{phyRow:3,phyCol:3,logicRow:2,logicCol:2,resolution:4,screenWidth:1018,screenHeight:573,frameTop:4,frameBottom:2,frameLeft:4,frameRight:2,cpTop:0,cpBottom:0,cpLeft:0,cpRight:0},{phyRow:3,phyCol:2,logicRow:2,logicCol:2,resolution:4,screenWidth:1018,screenHeight:573,frameTop:4,frameBottom:2,frameLeft:4,frameRight:2,cpTop:0,cpBottom:0,cpLeft:0,cpRight:0},{phyRow:2,phyCol:2,logicRow:2,logicCol:2,resolution:4,screenWidth:680,screenHeight:380,frameTop:3,frameBottom:2,frameLeft:2,frameRight:3,cpTop:0,cpBottom:0,cpLeft:0,cpRight:0},{phyRow:2,phyCol:2,logicRow:2,logicCol:2,resolution:4,screenWidth:680,screenHeight:380,frameTop:3,frameBottom:2,frameLeft:2,frameRight:3,cpTop:0,cpBottom:0,cpLeft:0,cpRight:0}],resolution:[{actHSize:1024,actVSize:768,hFront:24,vFront:3,hsWidth:136,vsWidth:6,hTotal:1344,vTotal:806,hSyncPol:1,vSyncPol:1,fps:60},{actHSize:1280,actVSize:720,hFront:110,vFront:5,hsWidth:40,vsWidth:5,hTotal:1650,vTotal:750,hSyncPol:1,vSyncPol:1,fps:60},{actHSize:1280,actVSize:1024,hFront:48,vFront:1,hsWidth:112,vsWidth:3,hTotal:1688,vTotal:1066,hSyncPol:1,vSyncPol:1,fps:60},{actHSize:1366,actVSize:768,hFront:70,vFront:3,hsWidth:143,vsWidth:3,hTotal:1792,vTotal:798,hSyncPol:1,vSyncPol:1,fps:60},{actHSize:1920,actVSize:1080,hFront:88,vFront:4,hsWidth:44,vsWidth:5,hTotal:2200,vTotal:1125,hSyncPol:0,vSyncPol:0,fps:60}],resDef:[{actHSize:1920,actVSize:1080,hFront:88,vFront:4,hsWidth:44,vsWidth:5,hTotal:2200,vTotal:1125,hSyncPol:0,vSyncPol:0,fps:60},{actHSize:1920,actVSize:1080,hFront:88,vFront:4,hsWidth:44,vsWidth:5,hTotal:2200,vTotal:1125,hSyncPol:0,vSyncPol:0,fps:60},{actHSize:1920,actVSize:1080,hFront:88,vFront:4,hsWidth:44,vsWidth:5,hTotal:2200,vTotal:1125,hSyncPol:0,vSyncPol:0,fps:60},{actHSize:1920,actVSize:1080,hFront:88,vFront:4,hsWidth:44,vsWidth:5,hTotal:2200,vTotal:1125,hSyncPol:0,vSyncPol:0,fps:60}],screenEnable:[true,true,false,false],software:{lang:"zh-CN",logicFill:false,menuPrompt:false,scenarioTip:false,logTip:false,ctrlInput:true,contentual:true,matrixInput:false,netVideoSource:false}};a.$scrollBar="";a.handleGblSettings();a.editPanelSize=a.requestResolution();a.handleDrawGrid();setTimeout(function(){a.handleGetSignalList();a.handleGetSceneList()},500);a.handleDroppablePanelScale();a.handleWindowAction();a.handlePanelSlide();a.handleLeftPanelTitleToggle();a.handleWallToggle();a.handleMouseDraw();a.handleSynWall(0);a.handleAuthority();if(!navigator.userAgent.match(/mobile/i)){a.$scrollBar=$("#sky-wrapper .left .tab-content").slimScroll({color:"#fff",size:"10px",height:"auto",alwaysVisible:false,distance:"3px",railVisible:true})}return a}SkyApp.prototype.log=function(b,a){if(typeof b=="undefined"){b="undefined"}else{if(b.length<=0){b="empty string"}else{b=b.toString().replace(/(<|>)/gi,"")}}b='<div class="msg-time">'+new Date().Format("yyyy-MM-dd hh:mm:ss")+"</div>"+b;Messenger.options={extraClasses:"messenger-fixed messenger-on-top messenger-on-right",theme:"flat",messageDefaults:"hello!"};return Messenger().post({message:b,type:a?a:"success",showCloseButton:true,hideAfter:5,closeButtonText:'<i class="fa fa-trash-o"></i>'})
};SkyApp.prototype.handleI18n=function(b,c,d){var a=this,d=d||a.settings.software.lang||navigator.language;$.i18n.properties({cache:true,name:b,path:c,mode:"both",language:d,callback:function(){$("[data-localize]").each(function(){var f=$(this),e=$.i18n.prop(f.data("localize"));if(f.is("input[type=text]")||f.is("input[type=password]")||f.is("input[type=email]")){f.attr("placeholder",e)}else{if(f.is("input[type=button]")||f.is("input[type=submit]")){f.attr("value",e)}else{if(f.is("[data-replace=left]")){f.html(e+f.html())}else{if(f.is("[data-replace=right]")){f.html(f.html()+e)}else{f.html(e)}}}}})}})};SkyApp.prototype.handleAuthority=function(){var a=this,b;b=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false);if(b){$("#user-name").html(b.name)}$("#user-menu li a").on(a.evClick,function(c){c.preventDefault();var d=$(this);if(d.hasClass("exit")){$.confirm({title:$.i18n.prop("index.modal.title.prompt"),message:$.i18n.prop("index.msg.exit"),btn:[$.i18n.prop("index.btn.cancel"),$.i18n.prop("index.btn.ok")],onSuccess:function(){$.get("logout",b,function(e){if(e==="SUCCESS"){sessionStorage.clear();$.removeCookie("authority");location.href="login.html"}})}})}});$("#ud-psw-form").bootstrapValidator({message:$.i18n.prop("user.authority.msg.invalid"),feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{old_psw:{message:$.i18n.prop("user.authority.msg.invalid"),validators:{notEmpty:{message:$.i18n.prop("user.authority.msg.psw_empty")},stringLength:{min:6,max:30,message:$.i18n.prop("user.authority.msg.psw_length_less")},regexp:{regexp:/^[a-zA-Z0-9_\.]+$/,message:$.i18n.prop("user.authority.msg.type_err")}}},new_psw:{validators:{notEmpty:{message:$.i18n.prop("user.authority.msg.psw_empty")},identical:{field:"confirm_psw",message:$.i18n.prop("user.authority.msg.psw_same_confirm")},different:{field:"old_psw",message:$.i18n.prop("user.authority.msg.psw_same_old")},stringLength:{min:6,max:30,message:$.i18n.prop("user.authority.msg.psw_length_less")},regexp:{regexp:/^[a-zA-Z0-9_\.]+$/,message:$.i18n.prop("user.authority.msg.type_err")}}},confirm_psw:{validators:{notEmpty:{message:$.i18n.prop("user.authority.msg.psw_empty")},identical:{field:"new_psw",message:$.i18n.prop("user.authority.msg.psw_same_confirm")},different:{field:"old_psw",message:$.i18n.prop("user.authority.msg.psw_same_old")},stringLength:{min:6,max:30,message:$.i18n.prop("user.authority.msg.psw_length_less")},regexp:{regexp:/^[a-zA-Z0-9_\.]+$/,message:$.i18n.prop("user.authority.msg.type_err")}}}}}).on("success.form.bv",function(f){f.preventDefault();var d=$("#modal-ud-psw form").serializeJson(),c={};b=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false);c.name=b.name;c.password=d.old_psw;c.new_password=d.new_psw;$.get("ud_psw",c,function(e){if(e==="FAIL"){var g=$.i18n.prop("user.authority.msg.psw_err");a.log(g)}else{$("#modal-ud-psw").modal("hide");var g=$.i18n.prop("user.authority.msg.psw_modified");a.log(g)}})}).find(".reset").on(a.evClick,function(c){c.preventDefault();$("#ud-psw-form").data("bootstrapValidator").resetForm(true)})};SkyApp.prototype.handleGblSettings=function(){var a=this,b;b=a.getCache1(a.tblSetting,true);if(!b){a.setCache1(a.tblSetting,a.settings,true)}else{a.settings=b}a.handleI18n("Messages","assets/",a.settings.software.lang);a.handleInitWall();a.handleSynScreeSettings(0);a.handleCommSettings();a.handleSoftwareSettings();a.handleSplicingSettings();a.handleVersionSettings()};SkyApp.prototype.handleInitWall=function(){var b=this;var a=$(b.selActiveWall).html();$(b.selWall).not(".active").html(a)};SkyApp.prototype.handleCommSettings=function(){var a=this;$("#comm_setting").on("shown.bs.modal",function(){var b=$(this);a.settings=a.getCache1(a.tblSetting,true);console.log(a.settings);$("#comm_tab li:eq("+a.settings.commType+") a").tab("show");$("#com_port").val(a.settings.commInfo[0].com_port);$("#com_baud_rate").val(a.settings.commInfo[0].com_baud_rate);$("#ip_addr").val(a.settings.commInfo[1].ip);$("#ip_port").val(a.settings.commInfo[1].port);$(".selectpicker").selectpicker("render");Inputmask("ip").mask("#ip_addr")});$("#comm_setting .yes").on(a.evClick,function(){var c=$("#comm_setting").find(".tab-pane.active form").serializeJson(),b=$("#comm_setting").find(".tab-pane.active").attr(a.attrCommType);console.log(c);a.settings.commType=b;if(b==="0"){a.settings.commInfo[0]=c}else{a.settings.commInfo[1].ip=c.ip;a.settings.commInfo[1].port=c.port}a.setCache1(a.tblSetting,a.settings,true)})};SkyApp.prototype.handleSoftwareSettings=function(){var self=this;$("#software_setting").on("shown.bs.modal",function(){var $this=$(this);self.settings=self.getCache1(self.tblSetting,true);var $langBtn=$this.find("#lang_btn [name=lang]."+self.settings.software.lang);$this.find("#lang_btn .btn").removeClass("active");$langBtn.parent().addClass("active");$langBtn.prop("checked",true);
    $this.find("#logic_fill input").prop("checked",self.settings.software.logicFill);$this.find("#menu_prompt input").prop("checked",self.settings.software.menuPrompt);$this.find("#scenario_tip input").prop("checked",self.settings.software.scenarioTip);$this.find("#log_tip input").prop("checked",self.settings.software.logTip);$this.find("#ctrl_input input").prop("checked",self.settings.software.ctrlInput);$this.find("#contentual input").prop("checked",self.settings.software.contentual);$this.find("#matrix_input input").prop("checked",self.settings.software.matrixInput);$this.find("#net_video_source input").prop("checked",self.settings.software.netVideoSource)});$("#software_setting #lang_switcher").off(self.evClick).on(self.evClick,function(){var lang=$("#software_setting [name=lang]:checked").val();self.settings.software.lang=lang;self.setCache1(self.tblSetting,self.settings,true);location.reload();return false});$("#software_setting input:checkbox").off(self.evClick).on(self.evClick,function(){var $this=$(this),name=$this.attr("name"),checked=$this.prop("checked"),cmd="self.settings.software."+name+"="+checked;eval(cmd);self.setCache1(self.tblSetting,self.settings,true)})};SkyApp.prototype.handleSplicingSettings=function(){var a=this;var e=a.settings.splice;for(var c=0;c<e.length;c++){var b=e[c];$(a.selDroppable).eq(c).attr(a.attrGrid,b.phyCol+"_"+b.phyRow+"_"+b.logicCol+"_"+b.logicRow);if(!a.settings.screenEnable[c]){var d=$("#wall-switcher").find("li:eq("+c+")");d.addClass("disabled");d.find("a").removeAttr("data-toggle")}}$("#splice_setting").on("shown.bs.modal",function(){var h=$(this);a.settings=a.getCache1(a.tblSetting,true);var k=a.settings.splice;for(var g=0;g<k.length;g++){var j=h.find(".tab-pane:eq("+g+")"),f=k[g];if(g!==0&&j.html()===""){j.html(h.find(".tab-pane:eq(0)").html())}j.find("input").each(function(){var l=$(this);if(l.attr("type")==="radio"){var i=parseInt(l.val());if(i===parseInt(f[l.attr("name")])){console.log("find",l.val());h.find(".resolution_select .btn").eq(g).removeClass("active");l.parent().addClass("active");l.prop("checked",true);$("#splice_setting .val_label").html(a.settings.resolution[i].actHSize+"x"+a.settings.resolution[i].actVSize)}}else{l.val(f[l.attr("name")])}})}h.find("#screen_enable input").each(function(n,o){var q=$(this),m=a.settings.screenEnable[n];q.prop("checked",m);if(!m){var p=$("#wall-switcher").find("li:eq("+n+")");p.addClass("disabled");p.find("a").removeAttr("data-toggle");var l=h.find(".nav.nav-tabs>li:eq("+n+")");l.addClass("disabled");l.find("a").removeAttr("data-toggle")}})});$("#splice_setting").on(a.evClick,".resolution_select label",function(){var f=$(this),h=f.find("input").val(),g=parseInt(h);f.parent().siblings(".val_label").html(a.settings.resolution[g].actHSize+"x"+a.settings.resolution[g].actVSize)});$("#splice_setting #screen_enable input[type=checkbox]").on(a.evClick,function(){var l=$(this),g=l.attr("name"),h=$("#splice_setting #screen_enable input[type=checkbox]").index(l),j=l.prop("checked"),f=$("#splice_setting .nav.nav-tabs>li:eq("+h+")"),k=$("#wall-switcher").find("li:eq("+h+")");if(j){k.removeClass("disabled");k.find("a").attr("data-toggle","tab");f.removeClass("disabled");f.find("a").attr("data-toggle","tab")}else{k.addClass("disabled");k.find("a").removeAttr("data-toggle","tab");f.addClass("disabled");f.find("a").removeAttr("data-toggle")}a.settings.screenEnable[h]=j;a.setCache1(a.tblSetting,a.settings,true)});$("#splice_setting .modal-footer .btn").on(a.evClick,function(){var l=$(this),k=$("#splice_setting .tab-content>.tab-pane.active"),h=k.prevAll().size();if(l.hasClass("sync")){a.handleSynScreeSettings(h);var g=a.settings.splice;for(var j=0;j<g.length;j++){var m=$("#splice_setting"),o=m.find(".tab-pane:eq("+j+")"),n=g[j];o.find("input").each(function(){var p=$(this);if(p.attr("type")==="radio"){var i=parseInt(p.val());if(i===parseInt(n[p.attr("name")])){console.log("find",p.val());m.find(".resolution_select .btn").removeClass("active");p.parent().addClass("active");p.prop("checked",true);m.find(".val_label").html(a.settings.resolution[i].actHSize+"x"+a.settings.resolution[i].actVSize)}}else{p.val(n[p.attr("name")])}})}}else{if(l.hasClass("apply")||l.hasClass("ok")){var n=k.find("form").serializeJson();console.log(n);var f="<wallmod,"+h+","+n.phyCol+","+n.phyRow+","+n.screenWidth+","+n.screenHeight+","+n.frameLeft+","+n.frameRight+","+n.frameTop+","+n.frameBottom+","+">";a.cmd(f,true,function(p){if(Number(n.resolution)!==Number(a.settings.splice[h].resolution)){a.settings.resDef[h]=a.settings.resolution[Number(n.resolution)]}a.settings.splice[h]=n;a.setCache1(a.tblSetting,a.settings,true);$(a.selDroppable).eq(h).attr(a.attrGrid,n.phyCol+"_"+n.phyRow+"_"+n.logicCol+"_"+n.logicRow);a.editPanelSize=a.requestResolution();a.handleDrawGrid();var i=$(a.selDroppable).eq(h).find(".pep");if(i.size()>0){a.handleCloseWinAll(i,true,true)}a.handleDelSceneAll($(a.selActiveSceneList).find("li.item"))},function(){});$("#splice_setting").modal("toggle")
}}});$("#advance_resolution").on("shown.bs.modal",function(){var h=$(this);a.settings=a.getCache1(a.tblSetting,true);var g=$("#splice_setting .tab-content>.tab-pane.active"),j=g.prevAll().size(),i=g.find("input[name=resolution]:checked").val(),f=a.settings.resolution[i];if(Number(i)===Number(a.settings.splice[j].resolution)){f=a.settings.resDef[j]}h.find("input").each(function(){var k=$(this);k.val(f[k.attr("name")])})});$("#advance_resolution .modal-footer .btn").on(a.evClick,function(){var j=$(this),f=$("#advance_resolution"),h=$("#splice_setting .tab-content>.tab-pane.active"),l=h.prevAll().size(),k=h.find("input[name=resolution]:checked").val(),g=a.settings.resolution[k];if(j.hasClass("def")){f.find("input").each(function(){var m=$(this);m.val(g[m.attr("name")])})}else{if(j.hasClass("ok")){var i=f.find("form").serializeJson();console.log(i);a.settings.resDef[l]=i}}})};SkyApp.prototype.handleVersionSettings=function(){var a=this;$("#version-name").html(a.version)};SkyApp.prototype.getWinCtrl=function(e,c,d,a){var b=this;e=typeof e==="undefined"?"":e;c=typeof c==="undefined"?"":c;d=typeof d==="undefined"?"":d;a=typeof a==="undefined"?"":a;return'<div class="pep window" '+b.attrWinId+'="'+c+'" '+b.attrWinSId+'="'+d+'" '+b.attrWinLevel+'="'+a+'">'+'<div class="title">'+"<span>"+e+"</span>"+'<div class="button close"><i class="fa fa-close"></i></div>'+'<div class="button fullscreen"><i class="fa fa-arrows-alt"></i></div>'+'<div class="button full-single-screen"><i class="fa fa-expand"></i></div>'+'<div class="button lock"><i class="fa fa-lock"></i></div>'+"</div>"+'<div class="content"></div>'+'<div class="coor nw"></div>'+'<div class="coor ne"></div>'+'<div class="coor sw"></div>'+'<div class="coor se"></div>'+'<div class="coor e"></div>'+'<div class="coor s"></div>'+'<div class="coor n"></div>'+'<div class="coor w"></div>'+"</div>"};SkyApp.prototype.getSignalCtrl=function(h,e,g){var c=this,f,d="",a="",b;h=typeof h==="undefined"?"":h;e=typeof e==="undefined"?"":e;g=typeof g==="undefined"?"":g;b=c.getColor(Number(h));if(g===0){f='<span class="fa-stack">'+'<i class="fa fa-plug fa-rotate-270 fa-stack-1x"></i>'+'<i class="fa fa-ban fa-stack-2x text-danger"></i>'+"</span>";d="disable"}else{f='<i class="fa fa-plug fa-rotate-270 fa-lg"></i>';a='draggable = "true"'}return'<li class="sky-btn item '+d+'" '+a+" "+c.attrSignalId+'="'+h+'" '+c.attrSignalValid+'="'+g+'" '+c.attrSignalColor+'="'+b+'" style="background: '+b+'">'+'<div class="placeholder-16-9"></div>'+'<div class="content">'+'<div class="display-table">'+'<div class="display-table-cell">'+f+" <a>"+h+"-"+e+"</a></div>"+"</div>"+"</div>"+f+"</li>"};SkyApp.prototype.getSceneCtrl=function(e,d,b,c){var a=this;e=typeof e==="undefined"?"":e;d=typeof d==="undefined"?"":d+e;c=typeof c==="undefined"?"":'style="background-image: url('+c+');"';b=typeof b==="undefined"?"":"valid";return'<li class="sky-btn item '+b+'" '+a.attrSceneId+'="'+e+'">'+'<i class="fa fa-bookmark-o fa-lg"></i>'+"<span>"+d+"</span>"+'<img class="scene-img" '+c+">"+"</li>"};SkyApp.prototype.handleLeftPanelTitleToggle=function(){var a=this;$('.left-footer-btn li a[data-toggle="tab"]').on("shown.bs.tab",function(){var c=$(this),b=$($('.left-footer-btn li a[data-toggle="tab"]')).index(c);b=b%2===0?1:2;c.closest(".panel-footer").siblings(".panel-heading").find("span").html($.i18n.prop("index.left.action.title"+b))})};SkyApp.prototype.handlePanelSlide=function(){var b=this,d=$(b.selWall),a=$(b.selDroppable);d.find(".collapse-btn").off(b.evClick).on(b.evClick,function(i){i.preventDefault();var h=$(this),f=h.index(),g=d.index($(b.selActiveWall));switch(f){case 1:d.eq(g).find(".row").addClass("off");break;case 2:d.eq(g).find(".row").removeClass("off");break;default:break}setTimeout(function(){b.editPanelSize=b.requestResolution();b.handleDrawGrid();b.handleSynWall(g)},700)});var c;$(window).on("resize",function(){clearTimeout(c);c=setTimeout(function(){if(!navigator.userAgent.match(/mobile/i)){$("#sky-wrapper .left .tab-content").slimScroll({destroy:true}).slimScroll({color:"#fff",size:"10px",height:"auto",alwaysVisible:false,distance:"3px",railVisible:true})}var e=$(b.selActiveDroppable),f=a.index(e);b.handleSynScreeSettings(f);b.editPanelSize=b.requestResolution();b.handleDrawGrid();b.handleSynWall(f)},700)})};SkyApp.prototype.handleWallToggle=function(){var a=this,b=$("#wall-switcher a");$("#wall-switcher").on("show.bs.tab",'a[data-toggle="tab"]',function(f){var d=$(this),c=b.index(d);setTimeout(function(){a.handleSynScreeSettings(c);a.handleSynWall(c)},300)})};SkyApp.prototype.handleGetSignalList=function(){var a=this,b,f,e,c;var d="<srcinf>";a.cmd(d,false,function(l){if(l&&l!=="offline"){if(l&&l.split("\r\n").length>2){b=l}else{return false}}else{if(l==="offline"){b="<The valid Input is : SRC TYPE SIGNAL SUB_VALID\r\n"+"01,VGA,1\r\n"+"02,VGA,0\r\n"+"03,HDMI,0\r\n"+"04,HDMI,1\r\n"+"05,BNCQ,3\r\n"+"06,BNCQ,5\r\n"+"07,4k,1\r\n"+"08,4k,1\r\n"+"09,4k,1\r\n"+"10,4k,1\r\n"+"11,DVI,0\r\n"+"12,DVI,0\r\n"+"13,DVI,0\r\n"+"14,DVI,0\r\n"+">"
}else{if(l===""){return false}}}var k=b.split("\r\n"),j=$(a.selInputList);j.html("");for(var h=1;h<k.length-1;h++){var g=k[h].split(",");f=parseInt(g[0]);e=g[1];c=parseInt(g[2]);j.append(a.getSignalCtrl(f,e,c))}j.find("li:first").addClass("active");j.off(a.evClick).on(a.evClick,"li",function(m){var i=$(this);if(i.attr(a.attrSignalValid)==="0"){a.log($.i18n.prop("index.msg.invalid.input_signal"))}else{$(a.selActiveInputList).find("li").removeClass("active");i.addClass("active")}});if(navigator.userAgent.match(/mobile/i)){a.handleTouchSignalDrag()}else{a.handlePCSignalDrag()}},function(){})};SkyApp.prototype.handlePCSignalDrag=function(){var self=this,$signal=$(self.selInputList).find("li"),$droppable=$(self.selDroppable),startX,startY;$signal.off("dragstart").on("dragstart",function(e){var $this=$(this),id=$this.attr(self.attrSignalId),valid=$this.attr(self.attrSignalValid),title=$this.find("a").html(),color=$this.attr(self.attrSignalColor),str=JSON.stringify({id:id,valid:valid,title:title,color:color,dX:e.originalEvent.pageX-$this.offset().left,dY:e.originalEvent.pageY-$this.offset().top,w:$this.width(),h:$this.height()});e.originalEvent.dataTransfer.setData("Text",str)});$(document).off("dragover").on("dragover",function(e){e.preventDefault()});$droppable.off("dragover").on("dragover",function(e){e.stopPropagation();e.preventDefault()});$droppable.off("drop").on("drop",function(e){e.stopPropagation();e.preventDefault();var $this=$(this),className,data=eval("("+e.originalEvent.dataTransfer.getData("Text")+")");className=e.target.className;if(className==="content"){var $pep=$(e.target).parent(),wallId=$droppable.index($this),winInfo=self.getWinInfoById(wallId,parseInt($pep.attr(self.attrWinId)));$pep.find(".title span").html(data.title);winInfo.title=data.title;winInfo.src_ch=data.id;winInfo.color=data.color;$pep.attr(self.attrWinSId,winInfo.src_ch);$pep.css({"background":winInfo.color});var cmd="<switch,"+wallId+","+winInfo.id+","+winInfo.src_ch+","+winInfo.src_hstart+","+winInfo.src_vstart+","+winInfo.src_hsize+","+winInfo.src_vsize+","+">";self.cmd(cmd,true,function(){self.insertOrUpdateWinInfo(wallId,winInfo)},function(){})}else{var wallId=$droppable.index($this),pTop=$this.offset().top,pLeft=$this.offset().left,winID,winLevel,idArr=[],levelArr=[],winInfo;if(isTouch(e)){startX=e.originalEvent.touches[0].pageX;startY=e.originalEvent.touches[0].pageY}else{startX=e.originalEvent.pageX-Number(data.dX);startY=e.originalEvent.pageY-Number(data.dY)}$this.find(".pep").each(function(){var _this=$(this);idArr.push(parseInt(_this.attr(self.attrWinId)));levelArr.push(parseInt(_this.attr(self.attrWinLevel)))});winID=idArr.queue();winLevel=levelArr.queue();winInfo={id:winID,level:winLevel,src_ch:data.id,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:data.title,color:data.color,win_x0:(startX-pLeft)/self.scale[wallId],win_y0:(startY-pTop)/self.scale[wallId],win_width:data.w,win_height:data.h};self.handleInitWindow($this,winInfo,true,true,true)}})};SkyApp.prototype.handleTouchSignalDrag=function(){var b=this,d=$(b.selInputList).find("li"),c={},a=false;d.hammer().on("panstart",function(p){p.preventDefault();var o=$(this),k=p.gesture.pointers[0].pageX,i=p.gesture.pointers[0].pageY,f=o.attr(b.attrSignalId),e=o.attr(b.attrSignalValid),q=o.find("a").html(),j=o.attr(b.attrSignalColor),s=o.offset().top,g=o.offset().left,r=o.width(),m=o.height(),n={id:f,valid:e,title:q,color:j,dX:k-g,dY:i-s,w:r,h:m};if(e==="0"){return false}$("#dragSignal").addClass("active").css({top:o.offset().top,left:o.offset().left,width:r,height:m,background:j}).find("span").html(q);c=n;a=true}).on("panmove",function(g){g.preventDefault();if(!a){return false}var f=g.gesture.pointers[0].pageX,e=g.gesture.pointers[0].pageY;$("#dragSignal").css({top:e-c.dY,left:f-c.dX})}).on("pancancel pressup",function(e){$("#dragSignal").removeClass("active")}).on("panend",function(q){q.preventDefault();if(!a){return false}$("#dragSignal").removeClass("active");var m=q.gesture.pointers[0].pageX,l=q.gesture.pointers[0].pageY,e=$(document.elementFromPoint(m,l)),g=e.prop("tagName");if(g==="DIV"&&e.hasClass("content")){var t=e.parent(),i=$(b.selActiveDroppable),o=$(b.selDroppable).index(i),p=b.getWinInfoById(o,parseInt(t.attr(b.attrWinId)));t.find(".title span").html(c.title);p.title=c.title;p.src_ch=c.id;p.color=c.color;t.attr(b.attrWinSId,p.src_ch);t.css({"background":p.color});var h="<switch,"+o+","+p.id+","+p.src_ch+","+p.src_hstart+","+p.src_vstart+","+p.src_hsize+","+p.src_vsize+","+">";b.cmd(h,true,function(){b.insertOrUpdateWinInfo(o,p)},function(){})}else{if(g==="CANVAS"){var i=$(b.selActiveDroppable),o=$(b.selDroppable).index(i),n=i.offset().top,s=i.offset().left,r,f,k=[],j=[],p;i.find(".pep").each(function(){var u=$(this);k.push(parseInt(u.attr(b.attrWinId)));j.push(parseInt(u.attr(b.attrWinLevel)))});r=k.queue();f=j.queue();p={id:r,level:f,src_ch:c.id,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:c.title,color:c.color,win_x0:(m-s-c.dX)/b.scale[o],win_y0:(l-n-c.dY)/b.scale[o],win_width:c.w,win_height:c.h};
    b.handleInitWindow(i,p,true,true,true)}}a=false})};SkyApp.prototype.handleGetSceneList=function(){var i=this,d=$(i.selSceneList),f,c,h,a,g=false;h=$.i18n.prop("index.left.scene.title");for(var e=0;e<i.settings.screenEnable.length;e++){var b="<readsc,"+e+">";i.cmd(b,false,function(q){if(q===""){return}if(d.eq(e).find("li").size()===0){for(var o=1;o<16;o++){d.eq(e).append(i.getSceneCtrl(o,h))}}else{d.eq(e).find("li.valid").removeClass("valid").find("img").css("background-image","")}if(q&&q!=="offline"){if(q&&q.split("\r\n").length>2){f=q}else{return}}else{if(q==="offline"){f="< The valid Scene ID is :\r\n"+"1,2,3,4\r\n"+">"}}c=f.split("\r\n");for(var p=1;p<c.length-1;p++){var l=c[p].split(",");for(var n=0;n<l.length;n++){var m=parseInt(l[n]);a=i.getSceneInfoById(e,m);if(a){d.eq(e).find("li").eq(m-1).after(i.getSceneCtrl(l[n],h,true,a.screenshot));d.eq(e).find("li").eq(m-1).remove();g=true;continue}}}},function(){})}i.handleSceneAction()};SkyApp.prototype.handleWindowAction=function(){var b=this,e=null,d,c,a=b.selActiveDroppable;$("#synchronize").on(b.evClick,function(h){h.preventDefault();$("#loader").show();var f=$(a),g=f.parent().index();b.handleSynScreeSettings(g);b.editPanelSize=b.requestResolution();b.handleDrawGrid();b.handleSynWall(g);b.handleGetSignalList();b.handleGetSceneList();$("#loader").fadeOut(300)});$("#sky-wrapper .right .new-win").on(b.evClick,function(o){o.preventDefault();e=$(a);var f=e.attr(b.attrGrid).split("_"),h=e.attr(b.attrGridStep).split("_"),z,s,p,l,w,v,r,q,g,n,u;if(f.length>0){z=parseInt(f[0]);s=parseInt(f[1]);p=parseInt(f[2]);l=parseInt(f[3])}if(h.length>0){w=parseFloat(h[0]).toFixed(4)*p;v=parseFloat(h[1]).toFixed(4)*l}g="position:absolute;"+"left: "+0+"px;"+"top:"+0+"px;"+"width:"+w+"px;"+"height:"+v+"px;"+"background: black";e.append('<span id="new-win-cursor" style="'+g+'"></span>');n=$("#new-win-cursor");outerLoop:for(var m=0;m<s;m++){innerLoop:for(var k=0;k<z;k++){r=k*w;q=m*v;n.css({left:r,top:q});if(e.find(".window").size()>0){var t=false;e.find(".window").each(function(){var i=$(this);u=b.isOverlapping(i,n,1);if(u){t=true;return false}});if(t){continue}else{d={id:0,level:0,src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:false,win_x0:r,win_y0:q,win_width:w,win_height:v};b.handleInitWindow(e,d,b.settings.software.logicFill,true,true);break outerLoop}}else{d={id:0,level:0,src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:false,win_x0:r,win_y0:q,win_width:w,win_height:v};b.handleInitWindow(e,d,b.settings.software.logicFill,true,true);break outerLoop}}}n.remove()});$("#sky-wrapper .right .close-win").on(b.evClick,function(f){f.preventDefault();c=$(b.selActiveDroppable).find(".pep.active");if(c.size()>0){b.handleCloseWin(c,true,true)}else{b.log($.i18n.prop("index.msg.no.select_win"))}});$("#sky-wrapper .right .clean-win").on(b.evClick,function(f){f.preventDefault();c=$(b.selActiveDroppable).find(".pep");if(c.size()>0){b.handleCloseWinAll(c,true,true)}});$("#sky-wrapper .right .draw-win").on(b.evClick,function(g){g.preventDefault();var f=$(this);if(f.hasClass("disable")){f.removeClass("disable");b.enableGesture=true;$(b.selActiveDroppable).css({cursor:"crosshair"})}else{f.addClass("disable");b.enableGesture=false;$(b.selActiveDroppable).css({cursor:"-webkit-grab"})}});$("#fullScr").on(b.evClick,function(){b.requestDocFullScreen();$(this).addClass("hide");$("#compressScr").removeClass("hide")});$("#compressScr").on(b.evClick,function(){b.exitDocFullscreen();$(this).addClass("hide");$("#fullScr").removeClass("hide")});b.handleMoreAction($("#sky-wrapper .right .sky-btn.dropdown"),false)};SkyApp.prototype.handleCloseWin=function(e,a,d){var b=this,f,c;f=$(b.selDroppable).index($(b.selActiveDroppable));e.each(function(){var h=$(this);if(a){c=h.attr(b.attrWinId);b.delWinInfoById(f,c);if(d){var g="<shut,"+f+","+c+">";b.cmd(g,true,function(){},function(){})}}$.pep.unbind(h);h.fadeOut(300,function(){h.remove()})})};SkyApp.prototype.handleCloseWinAll=function(d,a,c){var b=this,f;f=$(b.selDroppable).index($(b.selActiveDroppable));$.pep.unbind(d);d.fadeOut(300,function(){d.remove()});if(a){b.delWinInfoByWallId(f);if(c){var e="<reset,"+f+">";b.cmd(e,true,function(){},function(){})}}};SkyApp.prototype.handleUpdateWinAttr=function(a){var l=this,m=a.$el,h=m.attr(l.attrWinInfo).split(","),c=$(l.selActiveDroppable),f=$(l.selDroppable).index(c),i=Math.round(h[0]*l.scaleX[f]/l.scale[f]).toFixed(0),g=Math.round(h[1]*l.scaleY[f]/l.scale[f]).toFixed(0),j=Math.round(h[3]*l.scaleX[f]).toFixed(0),e=Math.round(h[2]*l.scaleY[f]).toFixed(0),k=m.attr(l.attrWinId),d=m.attr(l.attrWinSId),b=m.attr(l.attrWinLevel);$("#win-id").val(k);$("#win-sid").val(m.find(".title span").html());$("#win-x").val(i);$("#win-y").val(g);$("#win-w").val(j);$("#win-h").val(e);$("#modal-win-info").modal("show");$("#win-save").off(l.evClick).on(l.evClick,function(r){r.preventDefault();var n=Math.round($("#win-x").val()).toFixed(0),z=Math.round($("#win-y").val()).toFixed(0),q=Math.round($("#win-w").val()).toFixed(0),u=Math.round($("#win-h").val()).toFixed(0),v=n/l.scaleX[f],t=z/l.scaleY[f],A=q/l.scaleX[f],p=u/l.scaleY[f];
    console.log(v+"_"+t+"_"+A+"_"+p);console.log(v*l.scaleX[f],t*l.scaleY[f],A*l.scaleX[f],p*l.scaleY[f]);m.outerWidth(A);m.outerHeight(p);a.moveTo(v,t);var s={id:parseInt(k),level:parseInt(b),src_ch:parseInt(d),src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:m.find(".title span").html(),color:m.css("background-color"),win_x0:v,win_y0:t,win_width:A,win_height:p};m.attr(l.attrWinInfo,[v,t,p,A]);var o="<move,"+f+","+s.id+","+s.src_ch+","+s.src_hstart+","+s.src_vstart+","+s.src_hsize+","+s.src_vsize+","+n+","+z+","+q+","+u+">";l.cmd(o,true,function(){l.insertOrUpdateWinInfo(f,s);var w=$.i18n.prop("index.msg.win_index")+(parseInt(s.id)+1)+"<br>"+$.i18n.prop("index.msg.win_zindex")+(parseInt(s.level)+1)+"<br>"+$.i18n.prop("index.msg.win_pos")+"("+n+","+z+")"+"<br>"+$.i18n.prop("index.msg.win_size")+"("+q+","+u+")";m.find(".content").html(w)},function(){})})};SkyApp.prototype.handleDrawGrid=function(){var n=this,f=$(n.selDroppable),h=0,g=0,d=0,i=0,a,e,p,k,c,b,l,j,o,m;f.each(function(s,r){var q=$(this),C=$(r);a=C.attr(n.attrGrid);if(!a){return false}e=a.split("_");if(!(e instanceof Array)&&e.length<2){return false}h=e[0];g=e[1];d=e[2];i=e[3];q.find("canvas").remove();c=document.createElement("canvas");c.id="cvs"+h+"-"+g;c.width=n.editPanelSize[s].w;c.height=n.editPanelSize[s].h;c.style.cssText="background: #bababa;";C.append(c);b=c.getContext("2d");b.save();b.strokeStyle="#ffffff";b.fillStyle="#f7f7f7";b.lineWidth=0.6;l=n.editPanelSize[s].w/h;j=n.editPanelSize[s].h/g;o=l/d;m=j/i;for(var z=1;z<g*i;z++){if(z%i===0){b.beginPath();b.moveTo(0,m*z);b.lineTo(c.width,m*z);b.stroke();continue}b.beginPath();for(var y=0;y<l;y++){b.moveTo(y*10,m*z);b.lineTo(y*10+6,m*z)}b.stroke()}for(var x=1;x<h*d;x++){if(x%d===0){b.beginPath();b.moveTo(o*x,0);b.lineTo(o*x,c.height);b.stroke();continue}b.beginPath();for(var w=0;w<j;w++){b.moveTo(o*x,w*10);b.lineTo(o*x,w*10+6)}b.stroke()}var u=0,B,A;b.font='bold 60px/100% "微软雅黑", "Lucida Grande", "Lucida Sans", Helvetica, Arial, Sans';b.strokeStyle="#f7f7f7";for(var v=0;v<g;v++){for(var t=0;t<h;t++){B=c.width*((2*t+1)/(2*h));A=c.height*((2*v+1)/(2*g));b.strokeText(++u+"",B-20,A+20)}}b.restore();C.attr(n.attrGridStep,o+"_"+m)})};SkyApp.prototype.handleWindowCtrl=function(h,f,e){var i=this;h.css({width:f.win_width,height:f.win_height,background:f.color?f.color:f.color=i.getColor((Number(f.src_ch))),"z-index":f.level});h.pep({droppable:i.selActiveDroppable,dragIcon:".coor",selectFloat:true,allowDragEventPropagation:false,ignoreRightClick:true,minSize:{"w":50,"h":50},maxSize:null,elementsWithInteraction:".full-single-screen,.fullscreen,.close",revert:true,revertAfter:"ease",shouldEase:false,cssEaseDuration:100,revertIf:function(){return !this.activeDropRegions.length},useCSSTranslation:false,initiate:function(j,k){},startPos:{left:Number(f.win_x0),top:Number(f.win_y0)},start:function(j,k){k.noCenter=false},drag:function(j,k){},stop:function(n,k){var r=k.$el,j=r.parent(),m=r.attr(i.attrWinInfo).split(","),l=j.position().top,p=j.position().left,o=r.position().top-l,q=r.position().left-p;r.attr(i.attrWinInfo,[q,o,m[2],m[3]]);i.handleCentering(n,k)},rest:function(j,k){},onResizeEnd:function(m,p){var l=p.$el,o=l.parent(),n=l.attr(i.attrWinInfo).split(","),k=l.outerHeight(),j=l.outerWidth();l.attr(i.attrWinInfo,[n[0],n[1],k,j])}});var b=h.data("plugin_pep");i.handleInitWinCtrlAction(b);if(f.win_height==false||f.win_width==false){f.win_height=h.height();f.win_width=h.width()}h.attr(i.attrWinInfo,[f.win_x0,f.win_y0,f.win_height,f.win_width]);if(e){var c=b.$el.parent(),g=c.attr(i.attrGrid).split("_"),d=c.attr(i.attrGridStep).split("_"),a=[g[0]*g[2],g[1]*g[3],d[0],d[1]];i.requestFullSingleScreen(b,a,true)}return b};SkyApp.prototype.getStaticWinInfo=function(k,g,a){var l=this,i=0,f=0,b=0,j="",e="",h=$(l.selActiveInputList).find(".item.active");var d=[],c=[];if(k===null||typeof k==="undefined"){g.find(".pep").each(function(m,n){var o=$(this);d.push(parseInt(o.attr(l.attrWinId)));c.push(parseInt(o.attr(l.attrWinLevel)))});i=d.queue();f=h.attr(l.attrSignalId);f=f?f:1;b=c.queue();j=h.find("a").html();e=h.attr(l.attrSignalColor)}else{i=k.attr(l.attrWinId);f=k.attr(l.attrWinSId);b=k.attr(l.attrWinLevel);j=k.find(".title span").html();e=k.css("background")}a.id=parseInt(i);a.title=j;a.src_ch=parseInt(f);a.color=e;a.level=parseInt(b);return a};SkyApp.prototype.getDynamicWinInfo=function(e,b,o){var n=this,a,f,s,k,r,m,l,p,d,i,g,j,q;if(typeof e.attr(n.attrWinInfo)!="undefined"){var c=e.attr(n.attrWinInfo).split(",");i=c[0];g=c[1];j=c[3];q=c[2]}else{m=b.position().top;l=b.position().left;p=b.innerWidth();d=b.innerHeight();f=e.position().top-m;s=e.position().left-l;k=e.outerWidth();r=e.outerHeight();i=s-l;g=f-m;j=k;q=r;e.attr(n.attrWinInfo,[i,g,q,j])}o.level=parseInt(o.level?o.level:e.css("z-index"));o.color=o.color?o.color:e.css("background-color");o.win_x0=i;o.win_y0=g;o.win_width=j;o.win_height=q;return o};SkyApp.prototype.handleInitWindow=function(e,b,i,c,f){var l=this,j,k,g=$(l.selDroppable).index(e);if(b.id===0&&b.src_ch===0&&b.level===0){j=l.getStaticWinInfo(null,e,b)
}else{j=b}e.append(l.getWinCtrl(j.title,j.id,j.src_ch,j.level));k=e.find(".pep:last");var a=l.handleWindowCtrl(k,j,i);a.scale=l.scale[g];j=l.getDynamicWinInfo(k,e,j);if(c){var h=$(l.selDroppable).index(e);if(f){var d="<open,"+h+","+j.id+","+j.src_ch+","+j.src_hstart+","+j.src_vstart+","+j.src_hsize+","+j.src_vsize+","+Math.round(j.win_x0*l.scaleX[g]).toFixed(0)+","+Math.round(j.win_y0*l.scaleY[g]).toFixed(0)+","+Math.round(j.win_width*l.scaleX[g]).toFixed(0)+","+Math.round(j.win_height*l.scaleY[g]).toFixed(0)+">";l.cmd(d,true,function(m){l.insertOrUpdateWinInfo(h,j)},function(){})}else{l.insertOrUpdateWinInfo(h,j)}}};SkyApp.prototype.getRandomColor=function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).substr(-6)};SkyApp.prototype.getColor=function(b){var a=["#db7070","#db7091","#db70b7","#d770db","#ac70db","#8c70db","#7070db","#708cdb","#709bdb","#70afdb","#70c6db","#70dbd5","#70dbc6","#70dbac","#70db9b","#70db89","#70db75","#7adb70","#8edb70","#9bdb70","#acdb70","#c3db70","#d2db70","#dbd770","#dbc670","#dbb970","#dbb170","#dba070","#db9170","#db8470","#db7d70","#db7070"];return a[b*2]};SkyApp.prototype.handleInitWinCtrlAction=function(e){var a=this,d=e.$el,c=d.parent(),b=$("#content-pop-menu");d.on(a.evRightClick,function(f){f.preventDefault();var g={x:f.pageX,y:f.pageY};a.handleContentPopMenuAction(e,b,g)});d.find(".content").hammer({recognizers:[[Hammer.Press,{time:1000}],[Hammer.Tap,{event:"doubletap",taps:2}],]}).on(a.evPress,function(f){f.preventDefault();if(!navigator.userAgent.match(/mobile/i)){return false}a.handleContentPopMenuAction(e,b,false)}).on(a.evDbTap,function(){var h=c.attr(a.attrGrid).split("_"),g=c.attr(a.attrGridStep).split("_"),f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,true);setTimeout(function(){a.handleCentering(null,e)},300)});d.find(".close").hammer().on(a.evTap,function(f){f.preventDefault();a.handleCloseWin(d,true,true);e.options.constrainTo="window"});d.find(".lock").hammer().on(a.evTap,function(f){f.preventDefault();e.toggle(true);d.removeClass("lock")});d.find(".full-single-screen").hammer().on(a.evTap,function(){var h=c.attr(a.attrGrid).split("_"),g=c.attr(a.attrGridStep).split("_"),f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,true);setTimeout(function(){a.handleCentering(null,e)},300)});d.find(".fullscreen").hammer().on(a.evTap,function(){var h=c.attr(a.attrGrid).split("_"),g=c.attr(a.attrGridStep).split("_"),f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,false);setTimeout(function(){a.handleCentering(null,e)},300)})};SkyApp.prototype.handleContentPopMenuAction=function(a,e,i){var j=this,k=a.$el,b=k.parent();if(i){var h=e.find("ul"),d=h.height(),c=$(document).height(),g=i.x,f=i.y;if(d+i.y>c){f=c-d}h.css({left:g,top:f})}if(k.hasClass("lock")){e.find("a:not(.win-unlock,.win-attr)").addClass("disable")}else{e.find("a").removeClass("disable")}e.show();e.off(j.evClick).on(j.evClick,function(l){l.preventDefault();$(this).hide()});j.handleMoreAction(e,a)};SkyApp.prototype.handleMoreAction=function(b,c){var a=this;b.off(a.evClick,"a").on(a.evClick,"a",function(o){var m=$(this),q,n,e,r,f=$(a.selActiveDroppable),l=$(a.selDroppable).index(f);if(!c){r=f.find(".window.active");c=r.data("plugin_pep")}else{r=c.$el}if(r.size()==0){return}switch(m.attr("class")){case"single-screen":q=f.attr(a.attrGrid).split("_");n=f.attr(a.attrGridStep).split("_");e=[q[0]*q[2],q[1]*q[3],n[0],n[1]];a.requestFullSingleScreen(c,e,true);setTimeout(function(){a.handleCentering(null,c)},300);break;case"full-screen":q=f.attr(a.attrGrid).split("_");n=f.attr(a.attrGridStep).split("_");e=[q[0]*q[2],q[1]*q[3],n[0],n[1]];a.requestFullSingleScreen(c,e,false);setTimeout(function(){a.handleCentering(null,c)},300);break;case"up-level":var j=Number(r.css("z-index")),i=r.siblings("["+a.attrWinLevel+'="'+(j+1)+'"]');if(j!==r.siblings().size()-1){i.attr(a.attrWinLevel,j);i.css("z-index",j);r.attr(a.attrWinLevel,j+1);r.css("z-index",j+1);var h="<movz,"+l+","+r.attr(a.attrWinId)+","+(j+1)+">";a.cmd(h,true,function(s){a.handleCentering(null,c)},function(){});h="<movz,"+l+","+i.attr(a.attrWinId)+","+j+">";a.cmd(h,true,function(s){a.handleCentering(null,i.data("plugin_pep"))},function(){})}break;case"down-level":var j=Number(r.css("z-index")),d=r.siblings("["+a.attrWinLevel+'="'+(j-1)+'"]');if(j!==0){d.attr(a.attrWinLevel,j);d.css("z-index",j);r.attr(a.attrWinLevel,j-1);r.css("z-index",j-1);var h="<movz,"+l+","+r.attr(a.attrWinId)+","+(j-1)+">";a.cmd(h,true,function(s){a.handleCentering(null,c)},function(){});h="<movz,"+l+","+d.attr(a.attrWinId)+","+j+">";a.cmd(h,true,function(s){a.handleCentering(null,d.data("plugin_pep"))},function(){})}break;case"win-close":a.handleCloseWin(r,true,true);break;case"go-top":var j=Number(r.css("z-index")),k=r.siblings().size()-1,g=r.siblings();if(j===k){break}g.each(function(){var v=$(this),u=Number(v.attr(a.attrWinLevel)),s=v.attr(a.attrWinId);if(u>j){v.css("z-index",u-1);v.attr(a.attrWinLevel,u-1);var t="<movz,"+l+","+s+","+(u-1)+">";
    a.cmd(t,true,function(w){a.handleCentering(null,v.data("plugin_pep"))},function(){})}});r.css("z-index",k);r.attr(a.attrWinLevel,k);var h="<movz,"+l+","+r.attr(a.attrWinId)+","+k+">";a.cmd(h,true,function(s){a.handleCentering(null,c)},function(){});break;case"go-bottom":var j=Number(r.css("z-index")),p=0,g=r.siblings();if(j===p){break}g.each(function(){var v=$(this),u=Number(v.attr(a.attrWinLevel)),s=v.attr(a.attrWinId);if(u<j){v.css("z-index",u+1);v.attr(a.attrWinLevel,u+1);var t="<movz,"+l+","+s+","+(u+1)+">";a.cmd(t,true,function(w){a.handleCentering(null,v.data("plugin_pep"))},function(){})}});r.css("z-index",p);r.attr(a.attrWinLevel,p);var h="<movz,"+l+","+r.attr(a.attrWinId)+","+p+">";a.cmd(h,true,function(s){a.handleCentering(null,c)},function(){});break;case"win-lock":c.toggle(false);r.addClass("lock");break;case"win-unlock":c.toggle(true);r.removeClass("lock");break;case"win-restore":c.revert();break;case"win-attr":a.handleUpdateWinAttr(c);break;default:break}})};SkyApp.prototype.requestFullSingleScreen=function(F,a,G){var u=this,E=a.length,J=F.$el,v=J.parent();if(E===0||!a instanceof Array){return false}var p,o,m,h,n,I,q,H,s,r,w,e,D,d,c,t,g=$(u.selDroppable).index($(u.selActiveDroppable));p=a[0];o=a[1];m=a[2];h=a[3];s=v.position().top;r=v.position().left;w=v.innerWidth();e=v.innerHeight();n=J.position().top/u.scale[g];I=J.position().left/u.scale[g];q=J.outerWidth();H=J.outerHeight();if(!G){if(F.reverPosFull){J.outerWidth(F.reverPosFull.w);J.outerHeight(F.reverPosFull.h);F.moveTo(F.reverPosFull.x,F.reverPosFull.y);J.attr(u.attrWinInfo,[F.reverPosFull.x,F.reverPosFull.y,F.reverPosFull.h,F.reverPosFull.w]);F.reverPosFull=false}else{J.outerWidth(w);J.outerHeight(e);F.moveTo(0,0);F.reverPosFull={x:I,y:n,w:q,h:H};J.attr(u.attrWinInfo,[0,0,e,w])}}else{if(F.reverPos){J.outerWidth(F.reverPos.w);J.outerHeight(F.reverPos.h);F.moveTo(F.reverPos.x+r,F.reverPos.y+s);J.attr(u.attrWinInfo,[F.reverPos.x,F.reverPos.y,F.reverPos.h,F.reverPos.w]);F.reverPos=false}else{for(var C=0;C<p;C++){if(m*C<=I&&I<=m*(C+1)){d=m*C;break}}for(var B=0;B<o;B++){if(h*B<=n&&n<=h*(B+1)){D=h*B;break}}for(var A=0;A<p;A++){var f=I+q;if(m*A<=f&&f<=m*(A+1)){c=m*(A+1)-d;break}}for(var z=0;z<o;z++){var b=n+H;if(h*z<=b&&b<=h*(z+1)){t=h*(z+1)-D;break}}J.outerWidth(c);J.outerHeight(t);F.moveTo(d,D);F.reverPos={x:I,y:n,w:q,h:H};J.attr(u.attrWinInfo,[d,D,t,c])}}};SkyApp.prototype.handleCentering=function(q,i){var k=this,n,e,l;if(i.activeDropRegions.length>0){n=i.activeDropRegions[0];e=i.$el;var c=k.insideWithin(i),s=c[0],h=c[1],j=c[3],r=c[2],g=$(k.selDroppable).index(n),d=Math.round(s*k.scaleX[g]).toFixed(0),b=Math.round(h*k.scaleY[g]).toFixed(0),f=Math.round(j*k.scaleX[g]).toFixed(0),m=Math.round(r*k.scaleY[g]).toFixed(0);if((h<0&&h<-1*r/2)||h>n.outerHeight()-r/2){k.handleCloseWin(e,true,true);return}if((s<0&&s<-1*j/2)||s>n.outerWidth()-j/2){k.handleCloseWin(e,true,true);return}l={id:0,level:0,src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:e.css("background-color"),win_x0:s,win_y0:h,win_width:j,win_height:r};e.attr(k.attrWinInfo,c);l=k.getStaticWinInfo(e,n,l);var a=g;var p=$.i18n.prop("index.msg.win_index")+(parseInt(l.id)+1)+"<br>"+$.i18n.prop("index.msg.win_zindex")+(parseInt(l.level)+1)+"<br>"+$.i18n.prop("index.msg.win_pos")+"("+d+","+b+")"+"<br>"+$.i18n.prop("index.msg.win_size")+"("+f+","+m+")";e.find(".content").html(p);var o="<move,"+a+","+l.id+","+l.src_ch+","+l.src_hstart+","+l.src_vstart+","+l.src_hsize+","+l.src_vsize+","+d+","+b+","+f+","+m+">";k.cmd(o,true,function(t){k.insertOrUpdateWinInfo(a,l)},function(){})}};SkyApp.prototype.centerWithin=function(f){try{var d=f.activeDropRegions[0];var h=d.position().top;var l=d.position().left;var k=d.outerHeight();var b=d.outerWidth();var j=f.$el.position().top;var o=f.$el.position().left;var a=f.$el.outerHeight();var n=f.$el.outerWidth();var m=h+(k/2);var p=l+(b/2);if(!f.noCenter){if(!f.shouldUseCSSTranslation()){var c=m-(a/2);var g=p-(n/2);f.$el.animate({top:c,left:g},50)}else{var c=(m-j)-a/2;var g=(p-o)-n/2;f.moveToUsingTransforms(c,g)}f.noCenter=true;return}f.noCenter=false}catch(i){this.log(i.name+":"+i.message)}};SkyApp.prototype.insideWithin=function(n){var s=this,C=n.$el,t=n.activeDropRegions[0],g=$(s.selDroppable).index(t),r=t.position().top,q=t.position().left,e=t.height(),u=t.width(),l=C.position().top/s.scale[g],A=C.position().left/s.scale[g],f=C.attr(s.attrWinInfo).split(","),z=parseFloat(f[2]),o=parseFloat(f[3]),y=l,c=A;var a=t.attr(s.attrGrid).split("_"),d=t.attr(s.attrGridStep).split("_"),v=5,m,p,B,b,k,h;if(a.length>0){m=parseInt(a[0]);p=parseInt(a[1]);B=parseInt(a[2]);b=parseInt(a[3])}if(d.length>0){k=parseFloat(d[0]);h=parseFloat(d[1])}for(var x=0;x<=m*B;x++){if(Math.abs(A-k*x)<=v){c=k*x;break}if(Math.abs((A+o)-k*x)<=v){c=k*x-o;break}}for(var w=0;w<=p*b;w++){if(Math.abs(l-h*w)<=v){y=h*w;break}if(Math.abs((l+z)-h*w)<=v){y=h*w-z;break}}C.animate({top:y,left:c},0);return[c,y,z,o]};SkyApp.prototype.handleLogicAdsorbs=function(){};SkyApp.prototype.rotate=function(b,a){b.css({"transform":"rotate("+a+"deg)"})
};SkyApp.prototype.handleDroppablePanelScale=function(){var a=this;$(a.selDroppable).each(function(){a.scale.push(1)});$('#sky-wrapper .action-btn-group input[type="range"]').on("change",function(){var d=$(this),c=$(a.selActiveDroppable),b=$(a.selDroppable).index(c),e=1;e=d.val();a.scale[b]=e;c.parent().css({"transform":"scale("+e+")","transform-origin":e>1?"0 0 0":"center"});c.find(".pep").each(function(){var g=$(this),f=g.data("plugin_pep");f.setScale(e)})});a.mouseWheelScale()};SkyApp.prototype.mouseWheelScale=function(){var a=this,b=1,d=1,c=$(a.selDroppable);c.on("mousewheel",function(g,h){b+=h*0.1;if(b<1){b=1;return false}if(b>2){b=1.9;return false}var f=$(this),e=c.index(f);d=Math.abs(b);a.scale[e]=d;$(a.selActiveWall).find('.action-btn-group input[type="range"]').val(d);f.parent().css({"transform":"scale("+d+")","transform-origin":d>1?"0 0 0":"center"});f.find(".pep").each(function(){var k=$(this),j=k.data("plugin_pep"),i=j.options.constrainTo;j.setScale(d)});return false})};SkyApp.prototype.cmd=function(h,c,g,a){var b=this,d="cmd="+h,e,f;if(b.offline){g("offline");return false}if(b.settings.commType==="0"){d+="&com="+b.settings.commInfo[0].com_port+"&baudrate="+b.settings.commInfo[0].com_baud_rate}else{if(b.settings.commType==="1"){d+="&tcp=y&ip="+b.settings.commInfo[1].ip+"&port="+b.settings.commInfo[1].port}}e=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false);if(e){f=e.sessionId;d+="&sessionid="+f}$.ajax({url:b.serverUrl,data:d,type:"GET",async:c?c:false,contentType:"text/html;charset=UTF-8",success:function(i){if(b.settings.software.logTip){b.log(i)}console.log(i);if(g){g(i)}},error:function(i,k,j){console.log(i);console.log(k);console.log(j);if(a){a(i,k,j)}}})};SkyApp.prototype.requestDocFullScreen=function(){var a=document.documentElement;if(a.requestFullscreen){a.requestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullScreen){a.webkitRequestFullScreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}}}}};SkyApp.prototype.exitDocFullscreen=function(){var a=document;if(a.exitFullscreen){a.exitFullscreen()}else{if(a.mozCancelFullScreen){a.mozCancelFullScreen()}else{if(a.webkitCancelFullScreen){a.webkitCancelFullScreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}}}}};SkyApp.prototype.fitElement=function(b,a){$(b).off("load").on("load",function(){var j=$(this);var l=j.outerWidth();var e=j.outerHeight();var c;var g=$(a).innerWidth();var h=$(a).innerHeight();if(l/e>g/h){var i=Math.round(l/(e/h));var f=(g-i)/2;c="height:"+h+"px;width:"+i+"px;margin-left:"+f+"px;"}else{if(l/e<g/h){var k=Math.round(e/(l/g));var d=(h-k)/2;c="width:100%;margin-top:"+d+"px;"}else{c="width:100%"}}j.attr("style",c)})};SkyApp.prototype.requestResolution=function(){var j=this,d=$(j.selPlaceholder),p=$(j.selActivePlaceholder),q,b,l,c,h,o,s,g,f,a,e,k,r,m=[];l=p.parent().innerWidth();c=p.parent().innerHeight();j.scaleX=[];j.scaleY=[];o=j.settings.splice;for(var n=0;n<o.length;n++){s=o[n];g=s.phyRow;f=s.phyCol;a=j.settings.resDef[n].actHSize;e=j.settings.resDef[n].actVSize;k=f*a;r=g*e;if(l/c>=k/r){b=c-20;q=b*k/r;d.eq(n).css({"margin":"10px auto","width":q,"height":b,"left":"calc((100% - "+q+"px)/2)"})}else{q=l-20;b=q*r/k;h=(c-b)/2;d.eq(n).css({"margin":h+"px auto","width":q,"height":b,"left":"calc((100% - "+q+"px)/2)"})}j.scaleX.push(a*f/q);j.scaleY.push(e*g/b);m.push({w:q,h:b})}return m};SkyApp.prototype.handleMouseDraw=function(){var e=this,f=$(e.selDroppable),g={};var d,b,c,a;document.oncontextmenu=new Function("event.returnValue=false;");document.onselectstart=new Function("event.returnValue=false;");f.on(e.evStar,function(m){if(!e.enableGesture){return}else{m.stopPropagation();m.preventDefault()}if(isTouch(m)){m.pageX=m.originalEvent.touches[0].pageX;m.pageY=m.originalEvent.touches[0].pageY}else{if(m.button!==0||m.target.className==="content"){return false}}d=m.pageX;b=m.pageY;var l=$(this),i=l.offset().top,h=l.offset().left,k=f.index(l);$(".active-box").remove();var j=document.createElement("div");j.id="active-box";j.className="draw-box";j.style.top=(b-i)/e.scale[k]+"px";j.style.left=(d-h)/e.scale[k]+"px";l.append(j)});f.on(e.evMove,function(l){var k=$(this),h=$("#active-box"),i=f.index(k);if(isTouch(l)){l.pageX=l.originalEvent.touches[0].pageX;l.pageY=l.originalEvent.touches[0].pageY}if(typeof h!=="undefined"){h.width((l.pageX-d)/e.scale[i]);h.height((l.pageY-b)/e.scale[i])}var m=k.offset().top,j=k.offset().left;c=(l.pageX-j)/e.scale[i];a=(l.pageY-m)/e.scale[i];$(e.selWall).eq(i).find(".mouse-pos").html("x:"+Math.round(c*e.scaleX[i])+",y:"+Math.round(a*e.scaleY[i]))});f.on(e.evEnd,function(l){var k=$(this),h=$("#active-box"),i=f.index(k);if(h.size()!==0){h.removeAttr("id");if(h.width()>50&&h.height()>30){var k=$(this),m=k.offset().top,j=k.offset().left;c=(d-j)/e.scale[i];a=(b-m)/e.scale[i];g={id:0,level:0,src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:false,win_x0:c,win_y0:a,win_width:h.width(),win_height:h.height()};
    e.handleInitWindow(k,g,e.settings.software.logicFill,true,true)}h.remove()}});f.on(e.evOut,function(j){var i=$(this),h=f.index(i);$(e.selWall).eq(h).find(".mouse-pos").html("x:"+0+",y:"+0)})};SkyApp.prototype.handleSynchronizeWall=function(f){var m=this,e=$(m.selDroppable).eq(f);m.log($.i18n.prop("index.msg.synchronizing"));var j="<The valid window ID is : id levelnum Src_Ch src_hstart src_vstart src_hsize src_vsize win_x0 win_y0 win_width win_height\r\n"+"0,1,2,0,0,0,0,0,0,1920,1080\r\n"+"1,2,3,0,0,0,0,300,200,480,270\r\n"+"2,3,2,0,0,0,0,200,200,1920,1080\r\n"+"3,4,3,0,0,0,0,700,600,480,270\r\n"+"4,5,2,0,0,0,0,960,1440,1920,1080\r\n"+"5,6,3,0,0,0,0,300,200,480,270\r\n"+"7,6,3,0,0,0,0,400,200,480,700\r\n"+">";var u=j.split("\r\n"),o={},d=[];m.handleCloseWinAll($(m.selActiveDroppable).find(".pep"),true,false);for(var r=1;r<u.length-1;r++){var a=u[r].split(","),n=parseInt(a[0]),q=parseInt(a[1]),g=a[2],b=parseInt(a[3]),t=parseInt(a[4]),p=parseInt(a[5]),h=parseInt(a[6]),c=a[7],k=a[8],s=a[9],l=a[10];o={id:n,level:q,src_ch:g,src_hstart:b,src_vstart:t,src_hsize:p,src_vsize:h,title:$(".input ["+m.attrSignalId+"="+g+"] a").html(),win_x0:c/m.scaleX[f],win_y0:k/m.scaleY[f],win_width:s/m.scaleX[f],win_height:l/m.scaleY[f]};m.handleInitWindow(e,o,false,true,true)}m.log($.i18n.prop("index.msg.synchronized"))};SkyApp.prototype.getCache=function(a,b){return b?JSON.parse(localStorage.getItem(a)):localStorage.getItem(a)};SkyApp.prototype.getCache1=function(d,e){var b=this,g=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),c,f,a;if(b.offline){return b.getCache(d,e)}f={sessionId:g.sessionId,name:g.name,};switch(d){case b.tblSetting:c="r_setting";break;case b.tblSceneInfo:c="r_scene";break;case b.tblWinInfo:c="r_win";break}$.ajax({type:"get",url:c,data:f,async:false,success:function(h){if(h=="FAIL"){a=undefined}else{a=e?JSON.parse(h):h}}});return a};SkyApp.prototype.setCache1=function(c,g,d){var a=this,f=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),b,e;if(a.offline){a.setCache(c,g,d);return}e={sessionId:f.sessionId,name:f.name,val:d?JSON.stringify(g):g};switch(c){case a.tblSetting:b="cu_setting";break;case a.tblSceneInfo:b="cu_scene";break;case a.tblWinInfo:b="cu_win";break}$.get(b,e,function(h){})};SkyApp.prototype.setCache=function(a,c,b){localStorage.setItem(a,b?JSON.stringify(c):c)};SkyApp.prototype.delCache=function(a){localStorage.removeItem(a)};SkyApp.prototype.insertOrUpdateWinInfo=function(f,e){var c=this,g=c.tblWinInfo+f,a=c.getCache(g,true),b=false;if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===e.id){a[d]=e;b=true}}if(!b){a.push(e)}}else{a=[e]}c.setCache(g,a,true)};SkyApp.prototype.setWinInfoBatch=function(f,e){var b=this,g=b.tblWinInfo+f,a=b.getCache(g,true);if(a!==null){for(var d=0;d<a.length;d++){for(var c=0;c<e.length;c++){if(a[d].id===e[c].id){a[d]=e[c];e.splice(c,1)}}}a=a.concat(e)}else{a=e}b.setCache(g,a,true)};SkyApp.prototype.getWinInfoById=function(e,c){var b=this,f=b.tblWinInfo+e,a=b.getCache(f,true);if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===c){return a[d]}}}else{return null}};SkyApp.prototype.getWinInfoByWallID=function(c){var b=this,d=b.tblWinInfo+c,a=b.getCache(d,true);if(a!==null){return a}else{return null}};SkyApp.prototype.delWinInfoById=function(e,c){var b=this,f=b.tblWinInfo+e,a=b.getCache(f,true);if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===Number(c)){a.splice(d,1);b.setCache(f,a,true);return true}}}else{return false}};SkyApp.prototype.delWinInfoByWallId=function(b){var a=this,c=a.tblWinInfo+b;a.delCache(c)};SkyApp.prototype.insertOrUpdateSceneInfo=function(h,b){var k=this,l=null;if(k.offline){var d=k.tblSceneInfo+h,f=k.getCache(d,true),j;if(f!==null){for(var e=0;e<f.length;e++){if(f[e].id===b.id){f[e]=b;j=true}}if(!j){f.push(b)}}else{f=[b]}k.setCache(d,f,true)}else{var g=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),a="cu_scene",c;c={sessionId:g.sessionId,name:g.name,wallId:h,sceneId:b.id,val:b.screenshot};$.ajax({type:"get",url:a,data:c,async:false,success:function(i){if(i=="FAIL"){l=null}else{l=true}}});return l}};SkyApp.prototype.getSceneInfoById=function(h,b){var j=this,k=null;if(j.offline){var d=j.tblSceneInfo+h,f=j.getCache(d,true);if(f!==null){for(var e=0;e<f.length;e++){if(f[e].id===b){return f[e]}}}else{return null}}else{var g=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),a="r_scene",c;c={sessionId:g.sessionId,name:g.name,wallId:h,sceneId:b};$.ajax({type:"get",url:a,data:c,async:false,success:function(i){if(i=="FAIL"){k=null}else{k=JSON.parse(i)}}});return k}};SkyApp.prototype.getSceneInfoByWallId=function(f){var c=this,b=null;if(c.offline){var h=c.tblSceneInfo+f,a=c.getCache(h,true);if(a!==null){return a}else{return null}}else{var g=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),d="r_scene",e;
    e={sessionId:g.sessionId,name:g.name,wallId:f};$.ajax({type:"get",url:d,data:e,async:false,success:function(i){if(i=="FAIL"){b=null}else{b=JSON.parse(i)}}});return b}};SkyApp.prototype.delSceneByWallId=function(e){var b=this,a=false;if(b.offline){var g=b.tblSceneInfo+e;b.delCache(g);return true}else{var f=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),c="d_scene",d;d={sessionId:f.sessionId,name:f.name,wallId:e};$.ajax({type:"get",url:c,data:d,async:false,success:function(h){if(h=="FAIL"){a=false}else{a=true}}});return a}};SkyApp.prototype.delSceneById=function(h,b){var j=this,k=false;if(j.offline){var d=j.tblSceneInfo+h,f=j.getCache(d,true);if(f!==null){for(var e=0;e<f.length;e++){if(f[e].id===Number(b)){f.splice(e,1);j.setCache(d,f,true);return true}}}else{return false}}else{var g=sessionStorage.authority?JSON.parse(sessionStorage.authority):($.cookie("authority")?$.cookie("authority"):false),a="d_scene",c;c={sessionId:g.sessionId,name:g.name,wallId:h,sceneId:b};$.ajax({type:"get",url:a,data:c,async:false,success:function(i){if(i=="FAIL"){k=false}else{k=true}}});return k}};SkyApp.prototype.handleSynScreeSettings=function(d){var a=this,e={},b={};var c="<wallinf,"+d+">";a.cmd(c,false,function(j){if(j&&j!=="offline"){if(j.split("\r\n").length<2){return false}var f=j.split("\r\n"),k=[];for(var h=1;h<f.length-1;h++){var g=f[h].split(" ");k.push(g[g.length-1])}console.log(k);e=a.settings.splice[d];e.phyCol=k[0];e.phyRow=k[1];e.screenWidth=k[2];e.screenHeight=k[3];e.frameLeft=k[4];e.frameRight=k[5];e.frameTop=k[6];e.frameBottom=k[7];a.settings.splice[d]=e;b=a.settings.resDef[d];b.hFront=k[8];b.vFront=k[9];b.actHSize=k[10];b.actVSize=k[11];b.hTotal=k[12];b.vTotal=k[13];b.hsWidth=k[14];b.vsWidth=k[15];b.hSyncPol=k[16];b.vSyncPol=k[17];b.fps=k[18];a.settings.resDef[d]=b}else{if(j==="offline"){e=a.settings.splice[d]}}a.setCache1(a.tblSetting,a.settings,true);$(a.selDroppable).eq(d).attr(a.attrGrid,e.phyCol+"_"+e.phyRow+"_"+e.logicCol+"_"+e.logicRow)},function(){})};SkyApp.prototype.handleSynWall=function(f){var b=this,c=$(b.selActiveDroppable),a,e;var d="<winf,"+f+">";b.cmd(d,false,function(j){if(j&&j!=="offline"){if(j.split("\r\n").length<2){return false}b.handleCloseWinAll(c.find(".pep"),true,false);var g=j.split("\r\n");for(var h=1;h<g.length-1;h++){var k=g[h].split(",");e={id:parseInt(k[0]),level:parseInt(k[1]),src_ch:k[2],src_hstart:parseInt(k[3]),src_vstart:parseInt(k[4]),src_hsize:parseInt(k[5]),src_vsize:parseInt(k[6]),title:$(b.selActiveInputList).find(".item["+b.attrSignalId+"="+k[2]+"] a").html(),color:false,win_x0:k[7]/b.scaleX[f],win_y0:k[8]/b.scaleY[f],win_width:k[9]/b.scaleX[f],win_height:k[10]/b.scaleY[f]};b.handleInitWindow(c,e,false,true,false)}}else{if(j==="offline"){b.handleCloseWinAll(c.find(".pep"),false,false);a=b.getWinInfoByWallID(f);if(a!==null){for(var h=0;h<a.length;h++){e=a[h];e={id:parseInt(e.id),level:parseInt(e.level),src_ch:e.src_ch,src_hstart:parseInt(e.src_hstart),src_vstart:parseInt(e.src_vstart),src_hsize:parseInt(e.src_hsize),src_vsize:parseInt(e.src_vsize),title:e.title,color:e.color,win_x0:Number(e.win_x0),win_y0:Number(e.win_y0),win_width:Number(e.win_width),win_height:Number(e.win_height)};b.handleInitWindow(c,e,false,false)}}}}$("#loader").fadeOut(300,function(){})},function(){})};SkyApp.prototype.handleSceneAction=function(){var a=this,b=$("#scene-pop-menu"),c=$(a.selSceneList).find("li.item");a.handleScenePopMenuAction(b);c.off(a.evClick).on(a.evClick,function(){var d=$(this),e=$(a.selActiveSceneList);e.find("li.item").removeClass("active");d.addClass("active");if(d.hasClass("valid")){$("#modal-scene-preview").find(".modal-body").html(d.find(".scene-img").clone());$("#modal-scene-preview").modal("show")}});$("#modal-scene-preview").find(".ok").off(a.evClick).on(a.evClick,function(){var d=$(a.selActiveSceneList).find("li.item.active");a.handleLoadScene(d)});$("#modal-scene-preview").on("hidden.bs.modal",function(){$(this).find(".modal-body").html()});c.off(a.evRightClick).on(a.evRightClick,function(l){l.preventDefault();var j=$(this),i=$(a.selActiveSceneList),k={x:l.pageX,y:l.pageY};i.find("li.item").removeClass("active");j.addClass("active");b.find("li a").removeClass("disable");if(!j.hasClass("valid")){b.find("li :not(.sce-save,.sce-clean)").addClass("disable")}if(k){var h=b.find("ul"),e=h.height(),d=$(document).height(),g=k.x,f=k.y;if(e+k.y>d){f=d-e}h.css({left:g,top:f})}b.fadeIn(300)});if(navigator.userAgent.match(/mobile/i)){c.hammer().off(a.evPress).on(a.evPress,function(d){d.preventDefault();d.stopPropagation();var e=$(this),f=$(a.selActiveSceneList);f.find("li.item").removeClass("active");e.addClass("active");b.find("li a").removeClass("disable");if(!e.hasClass("valid")){b.find("li .sce-open").addClass("disable")}b.show()})}b.off(a.evClick).on(a.evClick,function(d){d.preventDefault();$(this).fadeOut(300,function(){$(this).find("li a").removeClass("disable")})});c.off(a.evDbClick).on(a.evDbClick,function(d){var e=$(this),f=$(a.selActiveSceneList);
    f.find("li.item").removeClass("active");e.addClass("active");if(e.hasClass("valid")){a.handleLoadScene(e)}});a.handleTouchSceneDrag()};SkyApp.prototype.handleTouchSceneDrag=function(){var b=this,c=$(b.selSceneList).find("li"),d={},a=false;c.hammer().on("panstart",function(n){var m=$(this),i=n.gesture.pointers[0].pageX,g=n.gesture.pointers[0].pageY,e=m.attr(b.attrSceneId),o=m.find("span").html(),q=m.offset().top,f=m.offset().left,p=m.width(),j=m.height(),k={id:e,title:o,dX:i-f,dY:g-q,w:p,h:j};if(!m.hasClass("valid")){return}$("#dragScene").addClass("active").css({top:m.offset().top,left:m.offset().left,width:p,height:j,}).find("span").html(o);d=k;a=true}).on("panmove",function(g){g.preventDefault();if(!a){return false}var f=g.gesture.pointers[0].pageX,e=g.gesture.pointers[0].pageY;$("#dragScene").css({top:e-d.dY,left:f-d.dX})}).on("pancancel pressup",function(e){$("#dragScene").removeClass("active")}).on("panend",function(i){i.preventDefault();if(!a){return false}$("#dragScene").removeClass("active");var h=i.gesture.pointers[0].pageX,g=i.gesture.pointers[0].pageY,e=$(document.elementFromPoint(h,g)),f=e.prop("tagName");if(f==="CANVAS"){b.handleLoadScene($(this))}a=false})};SkyApp.prototype.handleScenePopMenuAction=function(b){var a=this;b.find("a").off(a.evClick).on(a.evClick,function(){var d=$(this);var c=$(a.selActiveSceneList).find(".item.active");switch(d.attr("class")){case"sce-open":a.handleLoadScene(c);break;case"sce-save":a.handleSaveScene(c);break;case"sce-edit":break;case"sce-del":$.confirm({title:$.i18n.prop("index.modal.title.prompt"),message:$.i18n.prop("index.modal.msg.del"),btn:[$.i18n.prop("index.btn.cancel"),$.i18n.prop("index.btn.ok")],onSuccess:function(){a.handleDelScene(c)}});break;case"sce-clean":$.confirm({title:$.i18n.prop("index.modal.title.prompt"),message:$.i18n.prop("index.modal.msg.del.all"),btn:[$.i18n.prop("index.btn.cancel"),$.i18n.prop("index.btn.ok")],onSuccess:function(){a.handleDelSceneAll($(a.selActiveSceneList).find("li.item"))}});break;default:break}})};SkyApp.prototype.handleSaveScene=function(i){var j=this,g=$(j.selActiveSceneList).find("li.item"),d=g.index(i)+1,c,e,h,a,f;c=$(j.selActiveDroppable);e=$(j.selDroppable).index(c);var b="<save,"+e+","+d+">";j.cmd(b,true,function(k){h=j.getWinInfoByWallID(e);html2canvas(c.get(0),{allowTaint:true,taintTest:false,onrendered:function(l){$("#html-shoot").remove();l.id="html-shoot";f=l.toDataURL();i.find("img").css("background-image","url("+f+")");i.addClass("valid");a={id:d,screenshot:f,winInfo:h};j.insertOrUpdateSceneInfo(e,a)}})},function(){})};SkyApp.prototype.handleLoadScene=function(h){var i=this,f=$(i.selActiveSceneList).find("li.item"),d=f.index(h)+1,c,e,g,a;c=$(i.selActiveDroppable);e=$(i.selDroppable).index(c);var b="<call,"+e+","+d+">";i.cmd(b,true,function(k){if(k&&k!=="offline"){i.handleSynWall(e)}else{if(k==="offline"){i.handleCloseWinAll(c.find(".pep"),true,false);a=i.getSceneInfoById(e,d);if(a){g=a.winInfo;for(var j=0;j<g.length;j++){i.handleInitWindow(c,g[j],false,true,false)}}else{}}}},function(){})};SkyApp.prototype.handleDelScene=function(b){var a=this,g=$(a.selActiveSceneList).find("li.item"),c=g.index(b)+1,d,f;d=$(a.selActiveDroppable);f=$(a.selDroppable).index(d);var e="<delete,"+f+","+c+">";a.cmd(e,true,function(h){b.find("img").css({"background-image":""});b.removeClass("active").removeClass("valid");a.delSceneById(f,c)},function(){})};SkyApp.prototype.handleDelSceneAll=function(c){var b=this,d,f,a;d=$(b.selActiveDroppable);f=$(b.selDroppable).index(d);c.find("img").css({"background-image":""});c.removeClass("active").removeClass("valid");var e="<readsc,"+f+">";b.cmd(e,true,function(n){if(n&&n!=="offline"){if(n.split("\r\n").length<2){return false}a=n}else{if(n==="offline"){a="< The valid Scene ID is :\r\n"+"1,2,3,4,5,6,7,8,9\r\n"+">"}else{return false}}var l=a.split("\r\n");for(var k=1;k<l.length-1;k++){var g=l[k].split(",");for(var h=0;h<g.length;h++){var m="<delete,"+f+","+g[h]+">";b.cmd(m,true,function(i){b.delSceneByWallId(f)},function(){})}}},function(){})};SkyApp.prototype.isOverlapping=function(e,d,c){c=c?c:0;var b=e[0].getBoundingClientRect();var a=d[0].getBoundingClientRect();return !(b.right<a.left+c||b.left>a.right-c||b.bottom<a.top+c||b.top>a.bottom-c)};