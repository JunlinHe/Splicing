function SkyApp(){var a=this;a.offline=false;a.serverUrl="p";a.evClick="touchstart click";a.evTap="Tap";a.evDbClick="doubletap";a.evPressOrRightClick="press contextmenu";a.evStar="MSPointerStart pointerstart touchstart mousedown";a.evMove="MSPointerMove pointermove touchmove mousemove";a.evEnd="MSPointerUp pointerup touchend mouseup";a.evOut="MSPointerOut pointerout touchcancel mouseout";a.attrGrid="data-cvs-grid";a.attrGridStep="data-cvs-grid-step";a.attrWinId="data-win-id";a.attrWinSId="data-win-sid";a.attrWinInfo="data-win-info";a.attrSignalId="data-signal-id";a.attrSignalValid="data-signal-valid";a.attrSceneId="data-scene-id";a.attrCommType="data-comm-type";a.selWall="#sky-wrapper > .tab-content > .tab-pane";a.selActiveWall="#sky-wrapper > .tab-content > .tab-pane.active";a.selInputList="#sky-wrapper .input ul";a.selActiveInputList="#sky-wrapper > .tab-content > .tab-pane.active .input ul";a.selSceneList="#sky-wrapper .scene ul";a.selActiveSceneList="#sky-wrapper > .tab-content > .tab-pane.active .scene ul";a.selDragBtn=".input .item .drag";a.selDroppable="#sky-wrapper .placeholder>.droppable";a.selActiveDroppable="#sky-wrapper > .tab-content > .tab-pane.active .placeholder>.droppable";a.dbName="skyDB";a.tblWinInfo="tbl_win_wall";a.tblSceneInfo="tbl_scene_wall";a.tblSetting="tbl_setting";a.editPanelSize={w:false,h:false};a.scale=[];a.scaleX=[];a.scaleY=[];a.enableGesture=true;a.setting={};a.handleGblSettings();a.editPanelSize=a.request16to9();a.handleDrawGrid();a.handleGetSignalList();a.handleGetSceneList();a.handleDroppablePanelScale();a.handleWindowAction();a.handlePanelSlide();a.handleWallToggle();a.handleMouseDraw();a.handleSceneAction();a.handleLoadWall(0,$(a.selActiveDroppable));$(".loader").fadeOut(300,function(){});return a}SkyApp.prototype.log=function(b,a){if(typeof b=="undefined"){b="undefined"}else{if(b.length<=0){b="enpty string"}else{b=b.toString().replace(/(<|>)/gi,"")}}b='<div class="msg-time">'+new Date().Format("yyyy-MM-dd hh:mm:ss")+"</div>"+b;Messenger.options={extraClasses:"messenger-fixed messenger-on-top messenger-on-right",theme:"flat",messageDefaults:"hello!"};return Messenger().post({message:b,type:a?a:"success",showCloseButton:true,hideAfter:50,closeButtonText:'<i class="fa fa-trash-o"></i>'})};SkyApp.prototype.handleI18n=function(b,c,d){var a=this,d=d||a.setting.lang||navigator.language;$.i18n.properties({cache:true,name:b,path:c,mode:"both",language:d,callback:function(){$("[data-localize]").each(function(){var f=$(this),e=$.i18n.prop(f.data("localize"));if(f.is("input[type=text]")||f.is("input[type=password]")||f.is("input[type=email]")){f.attr("placeholder",e)}else{if(f.is("input[type=button]")||f.is("input[type=submit]")){f.attr("value",e)}else{if(f.is("[data-replace=left]")){f.html(e+f.html())}else{if(f.is("[data-replace=right]")){f.html(f.html()+e)}else{f.html(e)}}}}})}})};SkyApp.prototype.handleGblSettings=function(){var a=this;a.setting=a.getCache(a.tblSetting,true);console.log(a.setting);if(!a.setting){a.setting={lang:"zh-CN",logTip:false,fullSingleScreen:false,commType:"0",commInfo:[{type:0,val:["3","115200"]},{type:1,val:["192.168.1.128","0,8,220,1,2,3","255,255,255,0","192,168,1,1","5100"]}]};a.setCache(a.tblSetting,a.setting,true)}a.handleI18n("Messages","assets/",a.setting.lang);a.handleCommSettings();a.handleSoftwareSettings();a.handleSplicingSettings()};SkyApp.prototype.handleCommSettings=function(){var a=this;$("#comm_setting").on("show.bs.modal",function(){var b=$(this);a.setting=a.getCache(a.tblSetting,true);console.log(a.setting);$("#com_port").val(a.setting.commInfo[0].val[0]);$("#com_baud_rate").val(a.setting.commInfo[0].val[1]);$("#ip_addr").val(a.setting.commInfo[1].val[0]);$("#ip_port").val(a.setting.commInfo[1].val[4])});$("#comm_setting .yes").on(a.evClick,function(){var c=$("#comm_setting").find(".tab-pane.active form").serializeJson(),b=$("#comm_setting").find(".tab-pane.active").attr(a.attrCommType);console.log(c);a.setting.commType=b;a.setting.commInfo=c;a.setCache(a.tblSetting,a.setting,true)})};SkyApp.prototype.handleSoftwareSettings=function(){var a=this;$("#software_setting").on("show.bs.modal",function(){var b=$(this);a.setting=a.getCache(a.tblSetting,true);var c=b.find("#lang_btn [name=lang]."+a.setting.lang);b.find("#lang_btn .btn").removeClass("active");c.parent().addClass("active");c.prop("checked",true);b.find("#logic_fill input").prop("checked",a.setting.fullSingleScreen);b.find("#menu_prompt input").prop("checked",a.setting.menuPrompt);b.find("#scenario_tip input").prop("checked",a.setting.scenarioTip);b.find("#log_tip input").prop("checked",a.setting.logTip)});$("#software_setting #logic_fill input:checkbox").off(a.evClick).on(a.evClick,function(){var c=$(this),b;b=c.prop("checked");console.log(b);a.setting.fullSingleScreen=b;a.setCache(a.tblSetting,a.setting,true)});$("#software_setting #lang_switcher").off(a.evClick).on(a.evClick,function(){var b=$("#software_setting [name=lang]:checked").val();a.setting.lang=b;a.setCache(a.tblSetting,a.setting,true);
    location.reload();return false});$("#software_setting #menu_prompt input:checkbox").on(a.evClick,function(){var b=$(this),c=b.prop("checked");a.setting.menuPrompt=c;a.setCache(a.tblSetting,a.setting,true)});$("#software_setting #scenario_tip input:checkbox").on(a.evClick,function(){var c=$(this),b=c.prop("checked");a.setting.scenarioTip=b;a.setCache(a.tblSetting,a.setting,true)});$("#software_setting #log_tip input:checkbox").on(a.evClick,function(){var c=$(this),b=c.prop("checked");a.setting.logTip=b;a.setCache(a.tblSetting,a.setting,true)})};SkyApp.prototype.handleSplicingSettings=function(){var a=this;var b=$("#resolution_slider").slider({min:1,max:5,value:5,tooltip:"hide"}).on("slideStart",function(c){}).on("slide",function(c){}).on("slideStop",function(d){var f=d.value,c;switch(f){case 1:c="1024x768";break;case 2:c="1280x720";break;case 3:c="1280x1024";break;case 4:c="1366x768";break;default:c="1920x1080";break}$("#resolution_slider+.val_label").html(c);console.log("slideStop",d.value)})};SkyApp.prototype.getWinCtrl=function(d,b,c){var a=this;d=typeof d==="undefined"?"":d;b=typeof b==="undefined"?"":b;c=typeof c==="undefined"?"":c;return'<div class="pep window" '+a.attrWinId+'="'+b+'" '+a.attrWinSId+'="'+c+'">'+'<div class="title">'+"<span>"+d+"</span>"+'<div class="button close"><i class="fa fa-close"></i></div>'+'<div class="button fullscreen"><i class="fa fa-arrows-alt"></i></div>'+'<div class="button full-single-screen"><i class="fa fa-expand"></i></div>'+"</div>"+'<div class="content"></div>'+'<div class="coor nw"></div>'+'<div class="coor ne"></div>'+'<div class="coor sw"></div>'+'<div class="coor se"></div>'+'<div class="coor e"></div>'+'<div class="coor s"></div>'+'<div class="coor n"></div>'+'<div class="coor w"></div>'+"</div>"};SkyApp.prototype.getSignalCtrl=function(g,d,f){var b=this,e,c="",a="";g=typeof g==="undefined"?"":g;d=typeof d==="undefined"?"":d;f=typeof f==="undefined"?"":f;if(f===0){e='<span class="fa-stack">'+'<i class="fa fa-plug fa-rotate-270 fa-stack-1x"></i>'+'<i class="fa fa-ban fa-stack-2x text-danger"></i>'+"</span>";c="disable"}else{e='<i class="fa fa-plug fa-rotate-270 fa-lg"></i>';a='draggable = "true"'}return'<li class="sky-btn item '+c+'" >'+e+'<div class="drag" '+b.attrSignalId+'="'+g+'" '+b.attrSignalValid+'="'+f+'" '+a+">"+"<a>"+g+"-"+d+"</a>"+'<div class="content"></div>'+"</div>"+"</li>"};SkyApp.prototype.getSceneCtrl=function(e,d,b,c){var a=this;e=typeof e==="undefined"?"":e;d=typeof d==="undefined"?"":d+e;b=typeof b==="undefined"?"3x3":b;c=typeof c==="undefined"?"":'style="background-image: url('+c+');"';return'<li class="sky-btn item" '+a.attrSceneId+'="'+e+'">'+'<i class="fa fa-bookmark-o fa-lg"></i>'+"<span>"+d+"</span>"+'<img class="grid'+b+'" '+c+">"+"</li>"};SkyApp.prototype.handlePanelSlide=function(){var b=this,d=$(b.selWall),a=$(b.selDroppable);d.off(b.evClick,".collapse-btn").on(b.evClick,".collapse-btn",function(){var g=$(this);var e=g.index(),f=d.index($(b.selActiveWall));switch(e){case 1:d.eq(f).find(".row").addClass("off");break;case 2:d.eq(f).find(".row").removeClass("off");break;default:break}});var c;$(window).on("resize",function(){clearTimeout(c);c=setTimeout(function(){b.editPanelSize=b.request16to9();b.handleDrawGrid();var e=$(b.selActiveDroppable);var f=a.index(e);b.handleLoadWall(f,e)},700)})};SkyApp.prototype.handleWallToggle=function(){var a=this,b=$("#wall-toggle a");b.on(a.evClick,function(f){f.preventDefault();var d=$(this),c=b.index(d);d.tab("show");setTimeout(function(){a.handleLoadWall(c,$(a.selActiveDroppable))},300)})};SkyApp.prototype.handleGetSignalList=function(){var a=this,b,f,e,c;var d="<srcinf>";a.cmd(d,function(l){if(l&&l!=="offline"){if(l&&l.split(",").length>2){b=l}else{return false}}else{if(l==="offline"){b="<The valid Input is : SRC TYPE SIGNAL SUB_VALID\r\n"+"01,VGA,1\r\n"+"02,VGA,0\r\n"+"03,HDMI,0\r\n"+"04,HDMI,1\r\n"+"05,BNCQ,3\r\n"+"06,BNCQ,5\r\n"+"07,4k,1\r\n"+"08,4k,1\r\n"+"09,4k,1\r\n"+"10,4k,1\r\n"+"11,DVI,0\r\n"+"12,DVI,0\r\n"+"13,DVI,0\r\n"+"14,DVI,0\r\n"+">"}}var k=b.split("\r\n"),j=$(a.selInputList);j.html("");for(var h=1;h<k.length-1;h++){var g=k[h].split(",");f=parseInt(g[0]);e=g[1];c=parseInt(g[2]);j.append(a.getSignalCtrl(f,e,c))}j.find("li:first").addClass("active");j.on(a.evClick,"li",function(m){m.preventDefault();var i=$(this);if(i.find(".drag").attr(a.attrSignalValid)==="0"){a.log($.i18n.prop("index.msg.invalid.input_signal"))}else{$(a.selActiveInputList).find("li").removeClass("active");i.addClass("active")}});a.handleSignalDrag()},function(){})};SkyApp.prototype.handleSignalDrag=function(){var self=this,$signal=$(self.selInputList).find(".item .drag"),$droppable=$(self.selDroppable),startX,startY;$signal.on("dragstart",function(e){var $this=$(this),id=$this.attr(self.attrSignalId),valid=$this.attr(self.attrSignalValid),title=$this.find("a").html(),str=JSON.stringify({id:id,valid:valid,title:title});e.originalEvent.dataTransfer.setData("Text",str)});$(document).on("dragover",function(e){e.preventDefault()
});$droppable.on("dragover",function(e){e.stopPropagation();e.preventDefault()});$droppable.on("drop",function(e){e.stopPropagation();e.preventDefault();var $this=$(this),className,data=eval("("+e.originalEvent.dataTransfer.getData("Text")+")");className=e.target.className;if(className==="content"){var $pep=$(e.target).parent();$pep.find(".title span").html(data.title);var wallID=$droppable.index($this),winInfo=self.getWinInfoById(wallID,parseInt($pep.attr(self.attrWinId)));winInfo.title=data.title;winInfo.src_ch=data.id;var cmd="<switch,"+wallID+","+winInfo.id+","+winInfo.src_ch+","+winInfo.src_hstart+","+winInfo.src_vstart+","+winInfo.src_hsize+","+winInfo.src_vsize+","+">";self.cmd(cmd,function(){self.insertOrUpdateWinInfo(wallID,winInfo)},function(){})}else{var wallID=$droppable.index($this),$pep=$(e.target).parent(),pTop=$this.offset().top,pLeft=$this.offset().left,winID,idArr=[],winInfo;if(isTouch(e)){startX=e.originalEvent.touches[0].pageX;startY=e.originalEvent.touches[0].pageY}else{startX=e.originalEvent.pageX;startY=e.originalEvent.pageY}$this.find(".pep").each(function(){var _this=$(this);idArr.push(parseInt(_this.attr(self.attrWinId)))});winID=idArr.queue();winInfo={id:winID,level:$pep.css("z-index"),src_ch:data.id,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:data.title,color:self.getRandomColor(),win_x0:(startX-pLeft)/self.scale[wallID],win_y0:(startY-pTop)/self.scale[wallID],win_width:false,win_height:false};self.handleInitWindow($this,winInfo,self.setting.fullSingleScreen,true,true)}})};SkyApp.prototype.handleGetSceneList=function(){var i=this,d=$(i.selSceneList),e,c,h,a,f=false;var g=["3x3","2x2"];h=$.i18n.prop("index.left.scene.title");for(var j=0;j<g.length;j++){var b="<readsc,"+j+">";i.cmd(b,function(q){for(var o=1;o<33;o++){d.eq(j).append(i.getSceneCtrl(o,h,g[j]))}if(q&&q!=="offline"){if(q&&q.split(",").length>2){e=q}else{return false}}else{if(q==="offline"){e="< The valid Scene ID is :\r\n"+"1,2,3,4\r\n"+">"}}c=e.split("\r\n");for(var p=1;p<c.length-1;p++){var m=c[p].split(",");for(var n=0;n<m.length;n++){var l=parseInt(m[n]);a=i.getSceneInfoById(j,l);if(a){d.eq(j).find("li").eq(l-1).after(i.getSceneCtrl(m[n],h,g[j],a.screenshot));d.eq(j).find("li").eq(l-1).remove();f=true;break}}}},function(){})}};SkyApp.prototype.handleWindowAction=function(){var b=this,e=null,d,c,a=b.selActiveDroppable;$("#synchronize").on(b.evClick,function(h){h.preventDefault();var f=$(a),g=f.parent().index();b.handleLoadWall(g,f)});$("#sky-wrapper .right .new-win").on(b.evClick,function(f){f.preventDefault();e=$(a);d={id:0,level:0,src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:false,win_x0:0,win_y0:0,win_width:false,win_height:false};b.handleInitWindow(e,d,b.setting.fullSingleScreen,true,true)});$("#sky-wrapper .right .close-win").on(b.evClick,function(f){f.preventDefault();c=$(b.selActiveDroppable).find(".pep.active");if(c.size()>0){b.handleCloseWin(c,true,true)}else{b.log($.i18n.prop("index.msg.no.select_win"))}});$("#sky-wrapper .right .clean-win").on(b.evClick,function(f){f.preventDefault();c=$(b.selActiveDroppable).find(".pep");if(c.size()>0){b.handleCloseWinAll(c,true,true)}});$("#sky-wrapper .right .draw-win").on(b.evClick,function(g){g.preventDefault();var f=$(this);if(f.hasClass("disable")){f.removeClass("disable");b.enableGesture=true;$(b.selActiveDroppable).css({cursor:"crosshair"})}else{f.addClass("disable");b.enableGesture=false;$(b.selActiveDroppable).css({cursor:"-webkit-grab"})}})};SkyApp.prototype.handleCloseWin=function(f,a,e){var b=this,d,c;d=$(b.selDroppable).index($(b.selActiveDroppable));f.each(function(){var h=$(this);if(a){c=h.attr(b.attrWinId);b.delWinInfoById(d,c);if(e){var g="<shut,"+d+","+c+">";b.cmd(g,function(){},function(){})}}$.pep.unbind(h);h.fadeOut(300,function(){h.remove()})})};SkyApp.prototype.handleCloseWinAll=function(e,a,d){var b=this,c;c=$(b.selDroppable).index($(b.selActiveDroppable));$.pep.unbind(e);e.fadeOut(300,function(){e.remove()});if(a){b.delWinInfoByWallId(c);if(d){var f="<reset,"+c+">";b.cmd(f,function(){},function(){})}}};SkyApp.prototype.handleUpdateWinAttr=function(a){var k=this,l=a.$el,g=l.attr(k.attrWinInfo).split(","),b=$(k.selActiveDroppable),e=$(k.selDroppable).index(b),h=Math.round(g[0]*k.scaleX[e]/k.scale[e]).toFixed(0),f=Math.round(g[1]*k.scaleY[e]/k.scale[e]).toFixed(0),i=Math.round(g[3]*k.scaleX[e]).toFixed(0),d=Math.round(g[2]*k.scaleY[e]).toFixed(0),j=l.attr(k.attrWinId),c=l.attr(k.attrWinSId);$("#win-id").val(j);$("#win-sid").val(c);$("#win-x").val(h);$("#win-y").val(f);$("#win-w").val(i);$("#win-h").val(d);$("#modal-win-info").modal("show");$("#win-save").off(k.evClick).on(k.evClick,function(q){q.preventDefault();var m=Math.round($("#win-x").val()).toFixed(0),v=Math.round($("#win-y").val()).toFixed(0),p=Math.round($("#win-w").val()).toFixed(0),t=Math.round($("#win-h").val()).toFixed(0),u=m/k.scaleX[e],s=v/k.scaleY[e],z=p/k.scaleX[e],o=t/k.scaleY[e];console.log(u+"_"+s+"_"+z+"_"+o);console.log(u*k.scaleX[e],s*k.scaleY[e],z*k.scaleX[e],o*k.scaleY[e]);
    l.outerWidth(z);l.outerHeight(o);a.moveTo(u,s);var r={id:parseInt(j),level:parseInt(l.css("z-index")),src_ch:parseInt(c),src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:l.find(".title span").html(),color:l.css("background-color"),win_x0:u,win_y0:s,win_width:z,win_height:o};l.attr(k.attrWinInfo,[u,s,o,z]);var n="<move,"+e+","+r.id+","+r.src_ch+","+r.src_hstart+","+r.src_vstart+","+r.src_hsize+","+r.src_vsize+","+m+","+v+","+p+","+t+">";k.cmd(n,function(){k.insertOrUpdateWinInfo(e,r);var w="窗口标识:"+r.id+"<br>"+"窗口序号:"+r.level+"<br>"+"x,y:"+m+","+v+"<br>"+"w,h:"+p+","+t;l.find(".content").html(w)},function(){})})};SkyApp.prototype.handleDrawGrid=function(){var n=this,f=$(n.selDroppable),h=0,g=0,d=0,i=0,a,e,p,k,c,b,l,j,o,m;f.each(function(s,q){p=$(q);a=p.attr(n.attrGrid);if(!a){return false}e=a.split("_");if(!(e instanceof Array)&&e.length<2){return false}h=e[0];g=e[1];d=e[2];i=e[3];k=document.getElementById("cvs"+h+"-"+g);if(k!=null){k.parentNode.removeChild(k)}c=document.createElement("canvas");c.id="cvs"+h+"-"+g;c.width=n.editPanelSize.w;c.height=n.editPanelSize.h;c.style.cssText="background: #000;";p.append(c);b=c.getContext("2d");b.save();b.strokeStyle="#ffffff";b.fillStyle="#ffffff";b.lineWidth=0.6;l=n.editPanelSize.w/h;j=n.editPanelSize.h/g;o=l/d;m=j/i;for(var x=1;x<g*i;x++){if(x%i===0){b.beginPath();b.moveTo(0,m*x);b.lineTo(c.width,m*x);b.stroke();continue}b.beginPath();for(var w=0;w<l;w++){b.moveTo(w*10,m*x);b.lineTo(w*10+6,m*x)}b.stroke()}for(var v=1;v<h*d;v++){if(v%d===0){b.beginPath();b.moveTo(o*v,0);b.lineTo(o*v,c.height);b.stroke();continue}b.beginPath();for(var u=0;u<j;u++){b.moveTo(o*v,u*10);b.lineTo(o*v,u*10+6)}b.stroke()}var s=0,z,y;b.font='bold 60px/100% "微软雅黑", "Lucida Grande", "Lucida Sans", Helvetica, Arial, Sans';b.strokeStyle="#fff";for(var t=0;t<g;t++){for(var r=0;r<h;r++){z=c.width*((2*r+1)/(2*h));y=c.height*((2*t+1)/(2*g));b.strokeText(++s+"",z-20,y+20)}}b.restore();p.attr(n.attrGridStep,o+"_"+m)})};SkyApp.prototype.handleDragBtn=function(){var b=this,c=b.selActiveDroppable,a=$(b.selInputList).find(".item .drag");a.pep({droppable:c,constrainTo:"window",revert:true,revertAfter:"stop",revertIf:function(){return !this.activeDropRegions.length},overlapFunction:false,useCSSTranslation:false,initiate:function(d,f){var e=b.getStaticWinInfo(a,$(b.selActiveDroppable),{});f.$el.find(".content").append(b.getWinCtrl(e.title,e.id,e.src_ch))},drag:function(f,g){f=g.normalizeEvent(f);if(g.activeDropRegions.length!==0){var e=g.activeDropRegions[0].parents().filter(function(){var i=$(this);return i.is("body")||i.css("position")==="relative"||i.css("position")==="absolute"});if(e.length>1){var d=e.offset().left;var h=e.offset().top;g.customPosix={"x":f.pep.x-d,"y":f.pep.y-h}}else{g.customPosix={"x":f.pep.x,"y":f.pep.y}}}},stop:function(e,f){var d=f.$el.find(".content");if(this.activeDropRegions.length!==0){var g=this.activeDropRegions[0];g.append(genCtrl);b.handleInitWindow(g,{x:f.customPosix.x,y:f.customPosix.y,w:null,h:null},true,true,true)}d.html("")},rest:function(d,e){e.revert()}})};SkyApp.prototype.handleWindowCtrl=function(h,f,e){var i=this;h.css({width:f.win_width,height:f.win_height,background:f.color?f.color:f.color=i.getRandomColor()});h.pep({droppable:i.selActiveDroppable,dragIcon:".coor",selectFloat:true,allowDragEventPropagation:false,ignoreRightClick:false,minSize:{"w":100,"h":80},maxSize:null,constrainTo:"window",elementsWithInteraction:".close",revert:true,revertAfter:"ease",cssEaseDuration:300,revertIf:function(){return !this.activeDropRegions.length},useCSSTranslation:false,initiate:function(j,k){},startPos:{left:f.win_x0,top:f.win_y0},start:function(j,k){k.noCenter=false},drag:function(j,k){},stop:function(n,k){var r=k.$el,j=r.parent(),m=r.attr(i.attrWinInfo).split(","),l=j.position().top,p=j.position().left,o=r.position().top-l,q=r.position().left-p;r.attr(i.attrWinInfo,[q,o,m[2],m[3]])},rest:function(j,k){i.handleCentering(j,k)},onResizeEnd:function(m,p){var l=p.$el,o=l.parent(),n=l.attr(i.attrWinInfo).split(","),k=l.outerHeight(),j=l.outerWidth();l.attr(i.attrWinInfo,[n[0],n[1],k,j])}});var b=h.data("plugin_pep");i.handleInitWinCtrlAction(b);if(f.win_height==false||f.win_width==false){f.win_height=h.height();f.win_width=h.width()}h.attr(i.attrWinInfo,[f.win_x0,f.win_y0,f.win_height,f.win_width]);if(e){var c=b.$el.parent(),g=c.attr(i.attrGrid).split("_"),d=c.attr(i.attrGridStep).split("_"),a=[g[0]*g[2],g[1]*g[3],d[0],d[1]];i.requestFullSingleScreen(b,a,true)}return b};SkyApp.prototype.getStaticWinInfo=function(h,d,a){var i=this,f=0,c=0,g="",e=$(i.selActiveInputList).find(".item.active .drag");var b=[];if(h===null||typeof h==="undefined"){d.find(".pep").each(function(j,k){var l=$(this);b.push(parseInt(l.attr(i.attrWinId)))});f=b.queue();c=e.attr(i.attrSignalId);c=c?c:1;g=e.find("a").html()}else{f=h.attr(i.attrWinId);c=h.attr(i.attrWinSId);g=h.find(".title span").html()}a.id=parseInt(f);a.title=g;a.src_ch=parseInt(c);return a};SkyApp.prototype.getDynamicWinInfo=function(e,b,o){var n=this,a,f,s,k,r,m,l,p,d,i,g,j,q;
    if(typeof e.attr(n.attrWinInfo)!="undefined"){var c=e.attr(n.attrWinInfo).split(",");i=c[0];g=c[1];j=c[3];q=c[2]}else{m=b.position().top;l=b.position().left;p=b.innerWidth();d=b.innerHeight();f=e.position().top-m;s=e.position().left-l;k=e.outerWidth();r=e.outerHeight();i=s-l;g=f-m;j=k;q=r;e.attr(n.attrWinInfo,[i,g,q,j])}o.level=parseInt(o.level?o.level:e.css("z-index"));o.color=o.color?o.color:e.css("background-color");o.win_x0=i;o.win_y0=g;o.win_width=j;o.win_height=q;return o};SkyApp.prototype.handleInitWindow=function(e,b,h,c,f){var k=this,i,j,g=$(k.selDroppable).index(e);if(b.id===0&&b.src_ch===0&&b.level===0){i=k.getStaticWinInfo(null,e,b)}else{i=b}e.append(k.getWinCtrl(i.title,i.id,i.src_ch));j=e.find(".pep:last");var a=k.handleWindowCtrl(j,i,h);a.scale=k.scale[g];i=k.getDynamicWinInfo(j,e,i);if(c){var l=$(k.selDroppable).index(e);if(f){var d="<open,"+l+","+i.id+","+i.src_ch+","+i.src_hstart+","+i.src_vstart+","+i.src_hsize+","+i.src_vsize+","+Math.round(i.win_x0*k.scaleX[g]).toFixed(0)+","+Math.round(i.win_y0*k.scaleY[g]).toFixed(0)+","+Math.round(i.win_width*k.scaleX[g]).toFixed(0)+","+Math.round(i.win_height*k.scaleY[g]).toFixed(0)+">";k.cmd(d,function(m){k.insertOrUpdateWinInfo(l,i)},function(){})}else{k.insertOrUpdateWinInfo(l,i)}}};SkyApp.prototype.getRandomColor=function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).substr(-6)};SkyApp.prototype.handleInitWinCtrlAction=function(e){var a=this,d=e.$el,c=d.parent(),b=$("#content-pop-menu");d.hammer().on(a.evPressOrRightClick,function(f){f.preventDefault();b.fadeIn(300);b.on(a.evClick,function(g){g.preventDefault();$(this).fadeOut(300)});a.handleContentPopMenuAction(e,b)});d.find(".close").off(a.evClick).on(a.evClick,function(f){f.preventDefault();a.handleCloseWin(d,true,true);e.options.constrainTo="window"});d.find(".full-single-screen").on(a.evClick,function(){var h=c.attr(a.attrGrid).split("_"),g=c.attr(a.attrGridStep).split("_"),f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,true)});d.find(".fullscreen").on(a.evClick,function(){var h=c.attr(a.attrGrid).split("_"),g=c.attr(a.attrGridStep).split("_"),f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,false)});d.find(".content").hammer().on(a.evDbClick,function(){var h=c.attr(a.attrGrid).split("_"),g=c.attr(a.attrGridStep).split("_"),f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,true)})};SkyApp.prototype.handleContentPopMenuAction=function(e,d){var a=this,c=e.$el,b=c.parent();d.off(a.evClick,"a").on(a.evClick,"a",function(i){var j=$(this),h,g,f;switch(j.attr("class")){case"single-screen":h=b.attr(a.attrGrid).split("_");g=b.attr(a.attrGridStep).split("_");f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,true);setTimeout(function(){a.handleCentering(null,e)},300);break;case"full-screen":h=b.attr(a.attrGrid).split("_");g=b.attr(a.attrGridStep).split("_");f=[h[0]*h[2],h[1]*h[3],g[0],g[1]];a.requestFullSingleScreen(e,f,false);setTimeout(function(){a.handleCentering(null,e)},300);break;case"up-level":break;case"down-level":break;case"win-close":a.handleCloseWin(c,true,true);break;case"go-top":break;case"go-bottom":break;case"win-lock":e.toggle(false);d.find("a:not(.win-unlock,.win-attr)").addClass("disable");break;case"win-unlock":e.toggle(true);d.find("a").removeClass("disable");break;case"win-restore":e.revert();break;case"win-attr":a.handleUpdateWinAttr(e);break;default:break}})};SkyApp.prototype.requestFullSingleScreen=function(F,a,G){var u=this,E=a.length,J=F.$el,v=J.parent();if(E===0||!a instanceof Array){return false}var p,o,m,h,n,I,q,H,s,r,w,e,D,d,c,t,g=$(u.selDroppable).index($(u.selActiveDroppable));p=a[0];o=a[1];m=a[2]*u.scale[g];h=a[3]*u.scale[g];s=v.position().top;r=v.position().left;w=v.innerWidth();e=v.innerHeight();n=(J.position().top-s);I=(J.position().left-r);q=J.outerWidth();H=J.outerHeight();if(!G){if(Math.abs(n+s-s)<=1&&Math.abs(I+r-r)<=1&&Math.abs(q-w)<=1&&Math.abs(H-e)<=1){console.log("全屏最大化还原",11);if(F.reverPosix){J.outerWidth(F.reverPosix.w);J.outerHeight(F.reverPosix.h);F.moveTo(F.reverPosix.x/u.scale[g],F.reverPosix.y/u.scale[g]);J.attr(u.attrWinInfo,[F.reverPosix.x,F.reverPosix.y,F.reverPosix.h,F.reverPosix.w])}else{J.outerWidth(q);J.outerHeight(H);F.moveTo(I/u.scale[g],n/u.scale[g]);J.attr(u.attrWinInfo,[I,n,H,q])}}else{J.outerWidth(w);J.outerHeight(e);F.moveTo(0,0);F.reverPosix={x:I,y:n,w:q,h:H};J.attr(u.attrWinInfo,[0,0,e,w])}}else{for(var C=0;C<p;C++){if(m*C<=I&&I<=m*(C+1)){d=m*C;break}}for(var B=0;B<o;B++){if(h*B<=n&&n<=h*(B+1)){D=h*B;break}}for(var A=0;A<p;A++){var f=I*u.scale[g]+q;if(m*A<=f&&f<=m*(A+1)){c=m*(A+1)-d;break}}for(var z=0;z<o;z++){var b=n*u.scale[g]+H;if(h*z<=b&&b<=h*(z+1)){t=h*(z+1)-D;break}}console.log(n,I,q,H);console.log(s,r,w,e);console.log(D,d,c,t);if(Math.abs(n-D)<=1&&Math.abs(I-d)<=1&&Math.abs(q-c)<=1&&Math.abs(H-t)<=1){console.log("单屏最大化还原",11);if(F.reverPosix){J.outerWidth(F.reverPosix.w);J.outerHeight(F.reverPosix.h);F.moveTo(F.reverPosix.x+r,F.reverPosix.y+s);J.attr(u.attrWinInfo,[F.reverPosix.x,F.reverPosix.y,F.reverPosix.h,F.reverPosix.w])
}else{J.outerWidth(q);J.outerHeight(H);F.moveTo(I,n);J.attr(u.attrWinInfo,[I,n,H,q])}}else{J.outerWidth(c/u.scale[g]);J.outerHeight(t/u.scale[g]);F.moveTo(d/u.scale[g],D/u.scale[g]);F.reverPosix={x:I,y:n,w:q,h:H};J.attr(u.attrWinInfo,[d,D,t/u.scale[g],c/u.scale[g]])}}};SkyApp.prototype.handleCentering=function(k,e){var n=this,c,m,j;if(e.activeDropRegions.length>0){c=e.activeDropRegions[0];m=e.$el;var i=n.insideWithin(e),f=$(n.selDroppable).index(c),h=Math.round(i[0]/n.scale[f]*n.scaleX[f]).toFixed(0),g=Math.round(i[1]/n.scale[f]*n.scaleY[f]).toFixed(0),l=Math.round(i[3]*n.scaleX[f]).toFixed(0),d=Math.round(i[2]*n.scaleY[f]).toFixed(0);j={id:0,level:parseInt(m.css("z-index")),src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:m.css("background-color"),win_x0:i[0]/n.scale[f],win_y0:i[1]/n.scale[f],win_width:i[3],win_height:i[2]};m.attr(n.attrWinInfo,i);j=n.getStaticWinInfo(m,c,j);var o=f;var a="窗口标识:"+j.id+"<br>"+"窗口序号:"+j.level+"<br>"+"x,y:"+h+","+g+"<br>"+"w,h:"+l+","+d;m.find(".content").html(a);var b="<move,"+o+","+j.id+","+j.src_ch+","+j.src_hstart+","+j.src_vstart+","+j.src_hsize+","+j.src_vsize+","+h+","+g+","+l+","+d+">";n.cmd(b,function(p){n.insertOrUpdateWinInfo(o,j)},function(){})}};SkyApp.prototype.centerWithin=function(f){try{var d=f.activeDropRegions[0];var h=d.position().top;var l=d.position().left;var k=d.outerHeight();var b=d.outerWidth();var j=f.$el.position().top;var o=f.$el.position().left;var a=f.$el.outerHeight();var n=f.$el.outerWidth();var m=h+(k/2);var p=l+(b/2);if(!f.noCenter){if(!f.shouldUseCSSTranslation()){var c=m-(a/2);var g=p-(n/2);f.$el.animate({top:c,left:g},50)}else{var c=(m-j)-a/2;var g=(p-o)-n/2;f.moveToUsingTransforms(c,g)}f.noCenter=true;f.options.constrainTo=[h,l+b-n,h+k-a,l];return}f.noCenter=false}catch(i){this.log(i.name+":"+i.message)}};SkyApp.prototype.insideWithin=function(e){var o=this,p=e.$el,d=e.activeDropRegions[0],h=$(o.selDroppable).index(d),g=d.position().top,l=d.position().left,k=d.height(),b=d.width(),j=p.position().top-g,n=p.position().left-l,i=p.attr(o.attrWinInfo).split(","),a=i[2],m=i[3],c=j,f=n;console.log(g,l,b,k);console.log(j,n,m,a);if(0>j){c=0}else{if(k+a<j){c=k-a}}if(0>n){f=0}else{if(b-m<n){f=b-m}}p.animate({top:c/o.scale[h],left:f/o.scale[h]},0);e.options.constrainTo=[g,l+b-m,g+k-a,l];console.log("constrainTo",e.options.constrainTo);return[n,j,a,m]};SkyApp.prototype.rotate=function(b,a){b.css({"transform":"rotate("+a+"deg)"})};SkyApp.prototype.handleDroppablePanelScale=function(){var a=this;$(a.selDroppable).each(function(){a.scale.push(1)});$(".sky-btn.dropdown").off(a.evClick).on(a.evClick,"li",function(){var d=$(this),f=d.find("a").html(),c=$(a.selActiveDroppable),b=$(a.selDroppable).index(c),e=1;d.parent().siblings("a.dropdown-toggle").html(f+' <span class="caret"></span>');e=parseInt(f)*0.01;a.scale[b]=e;c.css({"transform":"scale("+e+")","transform-origin":e>1?"0 0 0":"center"});c.find(".pep").each(function(){var h=$(this),g=h.data("plugin_pep");g.setScale(e)})});a.mouseWheelScale()};SkyApp.prototype.mouseWheelScale=function(){var a=this,b=1,d=1,c=$(a.selDroppable);c.on("mousewheel",function(g,h){b+=h*0.1;if(b<0.5){b=0.6;return false}if(b>2){b=1.9;return false}var f=$(this),e=c.index(f);d=Math.abs(b);a.scale[e]=d;$(a.selActiveWall).find(".sky-btn.dropdown a.dropdown-toggle").html(Math.round(d*100).toFixed(0)+'% <span class="caret"></span>');f.css({"transform":"scale("+d+")","transform-origin":d>1?"0 0 0":"center"});f.find(".pep").each(function(){var i=$(this);i.data("plugin_pep").setScale(d)});return false})};SkyApp.prototype.cmd=function(e,d,a){var b=this,c="cmd="+e;if(b.offline){d("offline");return false}if(b.setting.commType==="0"){c+="&com="+b.setting.commInfo[0].val[0]+"&baudrate="+b.setting.commInfo[0].val[1]}else{if(b.setting.commType==="1"){c+="&tcp=y&ip="+b.setting.commInfo[1].val[0]+"&port="+b.setting.commInfo[1].val[4]}}$.ajax({url:b.serverUrl,data:c,type:"GET",async:false,contentType:"text/html;charset=UTF-8",success:function(f){if(b.setting.logTip){b.log(f)}console.log(f);if(d){d(f)}},error:function(f,h,g){console.log(f);console.log(h);console.log(g);if(a){a(f,h,g)}}})};SkyApp.prototype.requestDocFullScreen=function(){var a=document.documentElement;if(a.requestFullscreen){a.requestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullScreen){a.webkitRequestFullScreen()}}}};SkyApp.prototype.exitDocFullscreen=function(){var a=document;if(a.exitFullscreen){a.exitFullscreen()}else{if(a.mozCancelFullScreen){a.mozCancelFullScreen()}else{if(a.webkitCancelFullScreen){a.webkitCancelFullScreen()}}}};SkyApp.prototype.fitElement=function(b,a){$(b).off("load").on("load",function(){var j=$(this);var l=j.outerWidth();var e=j.outerHeight();var c;var g=$(a).innerWidth();var h=$(a).innerHeight();if(l/e>g/h){var i=Math.round(l/(e/h));var f=(g-i)/2;c="height:"+h+"px;width:"+i+"px;margin-left:"+f+"px;"}else{if(l/e<g/h){var k=Math.round(e/(l/g));var d=(h-k)/2;c="width:100%;margin-top:"+d+"px;"
}else{c="width:100%"}}j.attr("style",c)})};SkyApp.prototype.request16to9=function(){var c=this,d=$("#sky-wrapper .right .placeholder"),b,e,a,g,f;a=d.parent().innerWidth();g=d.parent().innerHeight();if(a/g>=16/9){e=g-20;b=e*16/9;d.css({"margin":"10px auto","width":b,"height":e,"left":"calc((100% - "+b+"px)/2)"})}else{b=a-20;e=b*9/16;f=(g-e)/2;d.css({"margin":f+"px auto","width":b,"height":e,"left":"calc((100% - "+b+"px)/2)"})}d.find(".droppable").each(function(){var j=$(this),i=j.attr(c.attrGrid).split("_"),h=i[0],k=i[1];c.scaleX.push(1920*h/b);c.scaleY.push(1080*k/e)});return{w:b,h:e}};SkyApp.prototype.requestCenter=function(){var d=this,b=$("#sky-wrapper .right .placeholder"),c,e,a,g,f};SkyApp.prototype.handleMouseDraw=function(){var e=this,f=$(e.selDroppable),g={};var d,b,c,a;document.oncontextmenu=new Function("event.returnValue=false;");document.onselectstart=new Function("event.returnValue=false;");f.on(e.evStar,function(m){if(!e.enableGesture){return false}if(isTouch(m)){m.pageX=m.originalEvent.touches[0].pageX;m.pageY=m.originalEvent.touches[0].pageY}else{if(m.button!==0||m.target.className==="content"){return false}}d=m.pageX;b=m.pageY;var l=$(this),i=l.offset().top,h=l.offset().left,k=f.index(l);var j=document.createElement("div");j.id="active-box";j.className="draw-box";j.style.top=(b-i)/e.scale[k]+"px";j.style.left=(d-h)/e.scale[k]+"px";l.append(j)});f.on(e.evMove,function(l){var k=$(this),h=$("#active-box"),i=f.index(k);if(isTouch(l)){l.pageX=l.originalEvent.touches[0].pageX;l.pageY=l.originalEvent.touches[0].pageY}if(typeof h!=="undefined"){h.width((l.pageX-d)/e.scale[i]);h.height((l.pageY-b)/e.scale[i])}var m=k.offset().top,j=k.offset().left;c=(l.pageX-j)/e.scale[i];a=(l.pageY-m)/e.scale[i];$(e.selWall).eq(i).find(".mouse-pos").html("x:"+Math.round(c*e.scaleX[i])+",y:"+Math.round(a*e.scaleY[i]))});f.on(e.evEnd,function(l){var k=$(this),h=$("#active-box"),i=f.index(k);if(h.size()!==0){h.removeAttr("id");if(h.width()>50&&h.height()>50){var k=$(this),m=k.offset().top,j=k.offset().left;c=(d-j)/e.scale[i];a=(b-m)/e.scale[i];g={id:0,level:0,src_ch:0,src_hstart:0,src_vstart:0,src_hsize:0,src_vsize:0,title:"",color:false,win_x0:c,win_y0:a,win_width:h.width(),win_height:h.height()};e.handleInitWindow(k,g,e.setting.fullSingleScreen,true,true)}h.remove()}});f.on(e.evOut,function(j){var i=$(this),h=f.index(i);$(e.selWall).eq(h).find(".mouse-pos").html("x:"+0+",y:"+0)})};SkyApp.prototype.handleSynchronizeWall=function(f){var m=this,e=$(m.selDroppable).eq(f);m.log($.i18n.prop("index.msg.synchronizing"));var j="<The valid window ID is : id levelnum Src_Ch src_hstart src_vstart src_hsize src_vsize win_x0 win_y0 win_width win_height\r\n"+"0,1,2,0,0,0,0,0,0,1920,1080\r\n"+"1,2,3,0,0,0,0,300,200,480,270\r\n"+"2,3,2,0,0,0,0,200,200,1920,1080\r\n"+"3,4,3,0,0,0,0,700,600,480,270\r\n"+"4,5,2,0,0,0,0,960,1440,1920,1080\r\n"+"5,6,3,0,0,0,0,300,200,480,270\r\n"+"7,6,3,0,0,0,0,400,200,480,700\r\n"+">";var u=j.split("\r\n"),o={},d=[];m.handleCloseWinAll($(m.selActiveDroppable).find(".pep"),true,false);for(var r=1;r<u.length-1;r++){var a=u[r].split(","),n=parseInt(a[0]),q=parseInt(a[1]),g=a[2],b=parseInt(a[3]),t=parseInt(a[4]),p=parseInt(a[5]),h=parseInt(a[6]),c=a[7],k=a[8],s=a[9],l=a[10];o={id:n,level:q,src_ch:g,src_hstart:b,src_vstart:t,src_hsize:p,src_vsize:h,title:$(".input ["+m.attrSignalId+"="+g+"] a").html(),win_x0:c/m.scaleX[f],win_y0:k/m.scaleY[f],win_width:s/m.scaleX[f],win_height:l/m.scaleY[f]};m.handleInitWindow(e,o,false,true,true)}m.log($.i18n.prop("index.msg.synchronized"))};SkyApp.prototype.getCache=function(a,b){return b?JSON.parse(localStorage.getItem(a)):localStorage.getItem(a)};SkyApp.prototype.setCache=function(a,c,b){localStorage.setItem(a,b?JSON.stringify(c):c)};SkyApp.prototype.delCache=function(a){localStorage.removeItem(a)};SkyApp.prototype.insertOrUpdateWinInfo=function(e,f){var c=this,g=c.tblWinInfo+e,a=c.getCache(g,true),b=false;if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===f.id){a[d]=f;b=true}}if(!b){a.push(f)}}else{a=[f]}c.setCache(g,a,true)};SkyApp.prototype.setWinInfoBatch=function(f,e){var b=this,g=b.tblWinInfo+f,a=b.getCache(g,true);if(a!==null){for(var d=0;d<a.length;d++){for(var c=0;c<e.length;c++){if(a[d].id===e[c].id){a[d]=e[c];e.splice(c,1)}}}a=a.concat(e)}else{a=e}b.setCache(g,a,true)};SkyApp.prototype.getWinInfoById=function(e,c){var b=this,f=b.tblWinInfo+e,a=b.getCache(f,true);if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===c){return a[d]}}}else{return null}};SkyApp.prototype.getWinInfoByWallID=function(c){var b=this,d=b.tblWinInfo+c,a=b.getCache(d,true);if(a!==null){return a}else{return null}};SkyApp.prototype.delWinInfoById=function(e,c){var b=this,f=b.tblWinInfo+e,a=b.getCache(f,true);if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===Number(c)){a.splice(d,1);b.setCache(f,a,true);return true}}}else{return false}};SkyApp.prototype.delWinInfoByWallId=function(b){var a=this,c=a.tblWinInfo+b;a.delCache(c)};SkyApp.prototype.insertOrUpdateSceneInfo=function(f,c){var d=this,g=d.tblSceneInfo+f,a=d.getCache(g,true),b;
    if(a!==null){for(var e=0;e<a.length;e++){if(a[e].id===c.id){a[e]=c;b=true}}if(!b){a.push(c)}}else{a=[c]}d.setCache(g,a,true)};SkyApp.prototype.getSceneInfoById=function(d,f){var b=this,e=b.tblSceneInfo+d,a=b.getCache(e,true);if(a!==null){for(var c=0;c<a.length;c++){if(a[c].id===f){return a[c]}}}else{return null}};SkyApp.prototype.getSceneInfoByWallId=function(c){var b=this,d=b.tblSceneInfo+c,a=b.getCache(d,true);if(a!==null){return a}else{return null}};SkyApp.prototype.delSceneByWallId=function(b){var a=this,c=a.tblSceneInfo+b;a.delCache(c)};SkyApp.prototype.delSceneById=function(e,b){var c=this,f=c.tblSceneInfo+e,a=c.getCache(f,true);if(a!==null){for(var d=0;d<a.length;d++){if(a[d].id===Number(b)){a.splice(d,1);c.setCache(f,a,true);return true}}}else{return false}};SkyApp.prototype.handleLoadWall=function(d,c){var b=this,a,f;var e="<winf,"+d+">";b.cmd(e,function(j){if(j&&j!=="offline"){if(j.split("\r\n").length<2){return false}b.handleCloseWinAll(c.find(".pep"),true,false);var g=j.split("\r\n");for(var h=1;h<g.length-1;h++){var k=g[h].split(",");f={id:parseInt(k[0]),level:parseInt(k[1]),src_ch:k[2],src_hstart:parseInt(k[3]),src_vstart:parseInt(k[4]),src_hsize:parseInt(k[5]),src_vsize:parseInt(k[6]),title:$(b.selActiveInputList).find(".item.active .drag a").html(),color:false,win_x0:k[7]/b.scaleX[d],win_y0:k[8]/b.scaleY[d],win_width:k[9]/b.scaleX[d],win_height:k[10]/b.scaleY[d]};b.handleInitWindow(c,f,false,true,false)}}else{if(j==="offline"){b.handleCloseWinAll(c.find(".pep"),false,false);a=b.getWinInfoByWallID(d);if(a!==null){for(var h=0;h<a.length;h++){f=a[h];f={id:parseInt(f.id),level:parseInt(f.level),src_ch:f.src_ch,src_hstart:parseInt(f.src_hstart),src_vstart:parseInt(f.src_vstart),src_hsize:parseInt(f.src_hsize),src_vsize:parseInt(f.src_vsize),title:f.title,color:f.color,win_x0:Number(f.win_x0),win_y0:Number(f.win_y0),win_width:Number(f.win_width),win_height:Number(f.win_height)};b.handleInitWindow(c,f,false,false)}}}}},function(){})};SkyApp.prototype.handleSceneAction=function(){var a=this,b=$("#scene-pop-menu"),c=$(a.selSceneList).find("li.item");a.handleScenePopMenuAction(b);c.hammer().on(a.evPressOrRightClick,function(d){d.preventDefault();var e=$(this),f=$(a.selActiveSceneList);f.find("li.item").removeClass("active");e.addClass("active");b.fadeIn(300);b.on(a.evClick,function(){$(this).fadeOut(300)})});c.hammer().on(a.evDbClick,function(){var d=$(this),e=$(a.selActiveSceneList);e.find("li.item").removeClass("active");d.addClass("active");a.handleLoadScene(d)})};SkyApp.prototype.handleScenePopMenuAction=function(b){var a=this;b.off(a.evClick,"a").on(a.evClick,"a",function(){var d=$(this);var c=$(a.selActiveSceneList).find(".item.active");switch(d.attr("class")){case"sce-open":a.handleLoadScene(c);break;case"sce-save":a.handleSaveScene(c);break;case"sce-edit":break;case"sce-del":$.confirm({title:$.i18n.prop("index.modal.title.prompt"),message:$.i18n.prop("index.modal.msg.del"),btn:[$.i18n.prop("index.modal.btn.cancel"),$.i18n.prop("index.modal.btn.confirm")],onSuccess:function(){a.handleDelScene(c)}});break;case"sce-clean":$.confirm({title:$.i18n.prop("index.modal.title.prompt"),message:$.i18n.prop("index.modal.msg.del.all"),btn:[$.i18n.prop("index.modal.btn.cancel"),$.i18n.prop("index.modal.btn.confirm")],onSuccess:function(){a.handleDelSceneAll($(a.selActiveSceneList).find("li.item"))}});break;default:break}})};SkyApp.prototype.handleSaveScene=function(h){var i=this,f=$(i.selActiveSceneList).find("li.item"),d=f.index(h)+1,c,j,g,a,e;c=$(i.selActiveDroppable);j=$(i.selDroppable).index(c);var b="<save,"+j+","+d+">";i.cmd(b,function(k){g=i.getWinInfoByWallID(j);html2canvas(c.get(0),{allowTaint:true,taintTest:false,onrendered:function(l){$("#html-shoot").remove();l.id="html-shoot";e=l.toDataURL();h.find("img").css("background-image","url("+e+")");a={id:d,screenshot:e,winInfo:g};i.insertOrUpdateSceneInfo(j,a)}})},function(){})};SkyApp.prototype.handleLoadScene=function(g){var h=this,e=$(h.selActiveSceneList).find("li.item"),d=e.index(g)+1,c,i,f,a;c=$(h.selActiveDroppable);i=$(h.selDroppable).index(c);var b="<call,"+i+","+d+">";h.cmd(b,function(k){h.handleCloseWinAll(c.find(".pep"),true,false);a=h.getSceneInfoById(i,d);if(a){f=a.winInfo;for(var j=0;j<f.length;j++){h.handleInitWindow(c,f[j],false,true,false)}}else{}},function(){})};SkyApp.prototype.handleDelScene=function(b){var a=this,g=$(a.selActiveSceneList).find("li.item"),c=g.index(b)+1,d,e;d=$(a.selActiveDroppable);e=$(a.selDroppable).index(d);var f="<delete,"+e+","+c+">";a.cmd(f,function(h){b.find("img").css({"background-image":""});b.removeClass("active");a.delSceneById(e,c)},function(){})};SkyApp.prototype.handleDelSceneAll=function(c){var b=this,d,e,a;d=$(b.selActiveDroppable);e=$(b.selDroppable).index(d);c.find("img").css({"background-image":""});c.removeClass("active");var f="<readsc,"+e+">";b.cmd(f,function(n){if(n&&n!=="offline"){if(n.split("\r\n").length<2){return false}a=n}else{if(n==="offline"){a="< The valid Scene ID is :\r\n"+"1,2,3,4,5,6,7,8,9\r\n"+">"
}}var l=a.split("\r\n");for(var k=1;k<l.length-1;k++){var g=l[k].split(",");for(var h=0;h<g.length;h++){var m="<delete,"+e+","+g[h]+">";b.cmd(m,function(i){b.delSceneByWallId(e)},function(){})}}},function(){})};