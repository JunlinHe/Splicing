<!DOCTYPE html>
<html lang="zh-CN" class="main-html">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title data-localize="login.title">登录</title>

    <!-- Bootstrap本地服务器css文件 -->
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="lib/bootstrap-validator/css/bootstrapValidator.min.css" rel="stylesheet">
    <link href="lib/font-awesome-4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="lib/titatoggle/titatoggle-dist.css" rel="stylesheet">

    <link href="css/app.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body class="main-body display-table">
<div class="display-table-cell">
    <div class="login-form">
        <div class="login-header">
            <span>显示管理平台</span>
        </div>
        <div class="login-body">
            <ul id="authority_tabs" class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a href="#login_tab" role="tab" data-toggle="tab">
                        登录
                    </a>
                </li>
                <li role="presentation">
                    <a href="#reg_tab" role="tab" data-toggle="tab">
                        注册
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane fade in active" id="login_tab">
                    <br>
                    <form id="login_form">
                        <div class="form-group">
                            <label for="login_name">用户名：</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-user"></i></span>
                                <input type="text" class="form-control" id="login_name" name="name" placeholder="用户名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="login_password">密码：</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-key"></i></span>
                                <input type="password" class="form-control" id="login_password" name="password" placeholder="密码">
                            </div>
                        </div>
                        <div class="sky-checkbox checkbox checkbox-slider--c">
                            <label>
                                <input name="rec_psw" type="checkbox" class="form-control"><span>记住密码</span>
                            </label>
                        </div>
                        <div id="login_result" class="alert alert-warning alert-dismissible fade in" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <span>账号密码错误</span>
                        </div>

                        <div class="form-group btn-float-r">
                            <input type="submit" class="btn login-btn" id="login" value="登录">
                        </div>
                    </form>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="reg_tab">
                    <br>
                    <form id="reg_form">
                        <div class="form-group">
                            <label for="reg_name">用户名：</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-user"></i></span>
                                <input type="text" class="form-control" id="reg_name" name="name" placeholder="用户名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="reg_password">密码：</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-key"></i></span>
                                <input type="password" class="form-control" id="reg_password" name="password" placeholder="密码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="reg_confirm_password">确认密码：</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-key"></i></span>
                                <input type="password" class="form-control" id="reg_confirm_password" name="confirm_password" placeholder="确认密码">
                            </div>
                        </div>
                        <div class="form-group btn-float-r">
                            <input type="reset" class="btn login-btn" id="reset" value="重置">
                            <input type="submit" class="btn login-btn" id="reg" value="注册">
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>


<!--js包-->
<script src="lib/modernizr.min.js" type="text/javascript"></script>
<script src="lib/jquery-2.1.4.min.js"></script>
<script src="lib/bootstrap/js/bootstrap.min.js"></script>
<script src="lib/bootstrap-validator/js/bootstrapValidator.min.js"></script>
<script src="lib/i18n/jquery.i18n.properties.js"></script>
<script src="lib/jquery-cookie/jquery.cookie.js" type="text/javascript"></script>

<script src="js/tool.js"></script>

<script>
$(function(){

    // cookie保存json格式
    $.cookie.json = true;

    $.i18n.properties({
        cache: true, // 缓存配置文件
        name: 'Messages',
        path: 'assets/',
        mode: 'both',
        language: 'zh-CN',
        callback: function () {

        }
    });

//    $('#reg').on('click', function(){
//
//        var json = $('.login_form form').serializeJson();
//
//        $.ajax({
//            url: 'r',
//            data: json,
//            type: 'GET',
//            contentType: 'text/html;charset=UTF-8',
//            success: function (data) {
//                alert(data);
//            },
//            error: function(){
//
//            }
//        });
//    });

//    $('#login').on('click', function(){
//
//        $('#login_form').submit();
//    });

    $('#login_form').bootstrapValidator({
        container: 'popover',
//        trigger: 'blur',
        message: $.i18n.prop('user.authority.msg.invalid'),
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            name: {
                message: $.i18n.prop('user.authority.msg.invalid'),
                validators: {
                    notEmpty: {
                        message: $.i18n.prop('user.authority.msg.name_empty')
                    },
                    stringLength: {
                        min: 5,
                        max: 10,
                        message: $.i18n.prop('user.authority.msg.name_length_less')
                    },
                    /*remote: {
                     url: 'remote.php',
                     message: 'The username is not available'
                     },*/
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\.]+$/,
                        message: $.i18n.prop('user.authority.msg.type_err')
                    }
                }
            },
            password: {
                validators: {
                    notEmpty: {
                        message: $.i18n.prop('user.authority.msg.psw_empty')
                    },
                    stringLength: {
                        min: 5,
                        max: 10,
                        message: $.i18n.prop('user.authority.msg.psw_length_less')
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\.]+$/,
                        message: $.i18n.prop('user.authority.msg.type_err')
                    }
                }
            },
//            captcha: {
//                validators: {
//                    callback: {
//                        message: 'Wrong answer',
//                        callback: function(value, validator) {
//                            var items = $('#captchaOperation').html().split(' '), sum = parseInt(items[0]) + parseInt(items[2]);
//                            return value == sum;
//                        }
//                    }
//                }
//            }
        }
    }).on('success.form.bv', function (e) {
        // Prevent form submission
        e.preventDefault();

        // Get the form instance
        var $form = $(e.target);

        var json = $('#login_form').serializeJson();
        $('#login_result').alert('close');

        // Get the BootstrapValidator instance
        var bv = $form.data('bootstrapValidator');

        // Use Ajax to submit form data
        $.get('l', json, function (data) {

            if(data === 'FAIL'){
                $('#login_password').val('').focus();
                $('#login_result').show();
                $('#login_result span').html($.i18n.prop('user.authority.msg.invalid_name_or_psw'))
            }else{
                var authority = {
                    sessionId: data,
                    name: json.name
                }

                if(''+json.rec_psw === 'on'){
                    $.cookie('authority', authority, { expires: 7 });
                }
                sessionStorage.authority = JSON.stringify(authority);
                location.href = 'index.html';
            }
        });
    });

    $('#reg_form').bootstrapValidator({
        container: 'popover',
//        trigger: 'blur',
        message: $.i18n.prop('user.authority.msg.invalid'),
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            name: {
                message: $.i18n.prop('user.authority.msg.invalid'),
                validators: {
                    notEmpty: {
                        message: $.i18n.prop('user.authority.msg.name_empty')
                    },
                    stringLength: {
                        min: 5,
                        max: 10,
                        message: $.i18n.prop('user.authority.msg.name_length_less')
                    },
//                    remote: {
//                     url: 'check_name',
//                     message: 'The username is not available'
//                     },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\.]+$/,
                        message: $.i18n.prop('user.authority.msg.type_err')
                    }
                }
            },
            password: {
                validators: {
                    notEmpty: {
                        message: $.i18n.prop('user.authority.msg.psw_empty')
                    },
                    identical: {
                        field: 'confirm_password',
                        message: $.i18n.prop('user.authority.msg.psw_same_confirm')
                    },
                    different: {
                        field: 'name',
                        message: $.i18n.prop('user.authority.msg.psw_same_name')
                    },
                    stringLength: {
                        min: 5,
                        max: 10,
                        message: $.i18n.prop('user.authority.msg.psw_length_less')
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\.]+$/,
                        message: $.i18n.prop('user.authority.msg.type_err')
                    }
                }
            },
            confirm_password:{
                validators: {
                    notEmpty: {
                        message: $.i18n.prop('user.authority.msg.psw_empty')
                    },
                    identical: {
                        field: 'password',
                        message: $.i18n.prop('user.authority.msg.psw_same_confirm')
                    },
                    different: {
                        field: 'name',
                        message: $.i18n.prop('user.authority.msg.psw_same_name')
                    },
                    stringLength: {
                        min: 5,
                        max: 10,
                        message: $.i18n.prop('user.authority.msg.psw_length_less')
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\.]+$/,
                        message: $.i18n.prop('user.authority.msg.type_err')
                    }
                }
            }
        }
    }).on('success.form.bv', function (e) {
        // Prevent form submission
        e.preventDefault();

        // Get the form instance
        var $form = $(e.target);

        var json = $('#reg_form').serializeJson();

        // Get the BootstrapValidator instance
        var bv = $form.data('bootstrapValidator');

        // Use Ajax to submit form data
        $.get('r', json, function (data) {
            if(data === 'SUCCESS'){
                // 自动登录
                $.get('l', json, function (data) {

                    if(data === 'FAIL'){
                        $('#login_password').val('').focus();
                        $('#login_result').show();
                        $('#login_result span').html($.i18n.prop('user.authority.msg.invalid_name_or_psw'))
                    }else{
                        var authority = {
                            sessionId: data,
                            name: json.name
                        }
                        sessionStorage.authority = JSON.stringify(authority);
                        location.href = 'index.html';
                    }
                });
            }else{
                alert('未知错误');
            }
        });
    }).find('#reset').on('click', function(ev) {
        ev.preventDefault();

        $('#reg_form').data('bootstrapValidator').resetForm(true);
    });
})
</script>
</body>
</html>